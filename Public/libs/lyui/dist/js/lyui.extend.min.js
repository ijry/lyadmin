!function(e){function t(){return new Date(Date.UTC.apply(Date,arguments))}"indexOf"in Array.prototype||(Array.prototype.indexOf=function(e,t){void 0===t&&(t=0),t<0&&(t+=this.length),t<0&&(t=0);for(var i=this.length;t<i;t++)if(t in this&&this[t]===e)return t;return-1});var i=function(t,i){var n=this;this.element=e(t),this.container=i.container||"body",this.language=i.language||this.element.data("date-language")||"en",this.language=this.language in s?this.language:this.language.split("-")[0],this.language=this.language in s?this.language:"en",this.isRTL=s[this.language].rtl||!1,this.formatType=i.formatType||this.element.data("format-type")||"standard",this.format=r.parseFormat(i.format||this.element.data("date-format")||s[this.language].format||r.getDefaultFormat(this.formatType,"input"),this.formatType),this.isInline=!1,this.isVisible=!1,this.isInput=this.element.is("input"),this.fontAwesome=i.fontAwesome||this.element.data("font-awesome")||!1,this.bootcssVer=i.bootcssVer||(this.isInput?this.element.is(".form-control")?3:2:this.bootcssVer=this.element.is(".input-group")?3:2),this.component=!!this.element.is(".date")&&(3==this.bootcssVer?this.element.find(".input-group-addon .glyphicon-th, .input-group-addon .glyphicon-time, .input-group-addon .glyphicon-calendar, .input-group-addon .glyphicon-calendar, .input-group-addon .fa-calendar, .input-group-addon .fa-clock-o").parent():this.element.find(".add-on .icon-th, .add-on .icon-time, .add-on .icon-calendar .fa-calendar .fa-clock-o").parent()),this.componentReset=!!this.element.is(".date")&&(3==this.bootcssVer?this.element.find(".input-group-addon .glyphicon-remove, .input-group-addon .fa-times").parent():this.element.find(".add-on .icon-remove, .add-on .fa-times").parent()),this.hasInput=this.component&&this.element.find("input").length,this.component&&0===this.component.length&&(this.component=!1),this.linkField=i.linkField||this.element.data("link-field")||!1,this.linkFormat=r.parseFormat(i.linkFormat||this.element.data("link-format")||r.getDefaultFormat(this.formatType,"link"),this.formatType),this.minuteStep=i.minuteStep||this.element.data("minute-step")||5,this.pickerPosition=i.pickerPosition||this.element.data("picker-position")||"bottom-right",this.showMeridian=i.showMeridian||this.element.data("show-meridian")||!1,this.initialDate=i.initialDate||new Date,this.zIndex=i.zIndex||this.element.data("z-index")||void 0,this.icons={leftArrow:this.fontAwesome?"fa-arrow-left":3===this.bootcssVer?"glyphicon-arrow-left":"icon-arrow-left",rightArrow:this.fontAwesome?"fa-arrow-right":3===this.bootcssVer?"glyphicon-arrow-right":"icon-arrow-right"},this.icontype=this.fontAwesome?"fa":"glyphicon",this._attachEvents(),this.clickedOutside=function(t){0===e(t.target).closest(".datetimepicker").length&&n.hide()},this.formatViewType="datetime","formatViewType"in i?this.formatViewType=i.formatViewType:"formatViewType"in this.element.data()&&(this.formatViewType=this.element.data("formatViewType")),this.minView=0,"minView"in i?this.minView=i.minView:"minView"in this.element.data()&&(this.minView=this.element.data("min-view")),this.minView=r.convertViewMode(this.minView),this.maxView=r.modes.length-1,"maxView"in i?this.maxView=i.maxView:"maxView"in this.element.data()&&(this.maxView=this.element.data("max-view")),this.maxView=r.convertViewMode(this.maxView),this.wheelViewModeNavigation=!1,"wheelViewModeNavigation"in i?this.wheelViewModeNavigation=i.wheelViewModeNavigation:"wheelViewModeNavigation"in this.element.data()&&(this.wheelViewModeNavigation=this.element.data("view-mode-wheel-navigation")),this.wheelViewModeNavigationInverseDirection=!1,"wheelViewModeNavigationInverseDirection"in i?this.wheelViewModeNavigationInverseDirection=i.wheelViewModeNavigationInverseDirection:"wheelViewModeNavigationInverseDirection"in this.element.data()&&(this.wheelViewModeNavigationInverseDirection=this.element.data("view-mode-wheel-navigation-inverse-dir")),this.wheelViewModeNavigationDelay=100,"wheelViewModeNavigationDelay"in i?this.wheelViewModeNavigationDelay=i.wheelViewModeNavigationDelay:"wheelViewModeNavigationDelay"in this.element.data()&&(this.wheelViewModeNavigationDelay=this.element.data("view-mode-wheel-navigation-delay")),this.startViewMode=2,"startView"in i?this.startViewMode=i.startView:"startView"in this.element.data()&&(this.startViewMode=this.element.data("start-view")),this.startViewMode=r.convertViewMode(this.startViewMode),this.viewMode=this.startViewMode,this.viewSelect=this.minView,"viewSelect"in i?this.viewSelect=i.viewSelect:"viewSelect"in this.element.data()&&(this.viewSelect=this.element.data("view-select")),this.viewSelect=r.convertViewMode(this.viewSelect),this.forceParse=!0,"forceParse"in i?this.forceParse=i.forceParse:"dateForceParse"in this.element.data()&&(this.forceParse=this.element.data("date-force-parse"));for(var a=3===this.bootcssVer?r.templateV3:r.template;a.indexOf("{iconType}")!==-1;)a=a.replace("{iconType}",this.icontype);for(;a.indexOf("{leftArrow}")!==-1;)a=a.replace("{leftArrow}",this.icons.leftArrow);for(;a.indexOf("{rightArrow}")!==-1;)a=a.replace("{rightArrow}",this.icons.rightArrow);if(this.picker=e(a).appendTo(this.isInline?this.element:this.container).on({click:e.proxy(this.click,this),mousedown:e.proxy(this.mousedown,this)}),this.wheelViewModeNavigation&&(e.fn.mousewheel?this.picker.on({mousewheel:e.proxy(this.mousewheel,this)}):console.log("Mouse Wheel event is not supported. Please include the jQuery Mouse Wheel plugin before enabling this option")),this.isInline?this.picker.addClass("datetimepicker-inline"):this.picker.addClass("datetimepicker-dropdown-"+this.pickerPosition+" dropdown-menu"),this.isRTL){this.picker.addClass("datetimepicker-rtl");var o=3===this.bootcssVer?".prev span, .next span":".prev i, .next i";this.picker.find(o).toggleClass(this.icons.leftArrow+" "+this.icons.rightArrow)}e(document).on("mousedown",this.clickedOutside),this.autoclose=!1,"autoclose"in i?this.autoclose=i.autoclose:"dateAutoclose"in this.element.data()&&(this.autoclose=this.element.data("date-autoclose")),this.keyboardNavigation=!0,"keyboardNavigation"in i?this.keyboardNavigation=i.keyboardNavigation:"dateKeyboardNavigation"in this.element.data()&&(this.keyboardNavigation=this.element.data("date-keyboard-navigation")),this.todayBtn=i.todayBtn||this.element.data("date-today-btn")||!1,this.todayHighlight=i.todayHighlight||this.element.data("date-today-highlight")||!1,this.weekStart=(i.weekStart||this.element.data("date-weekstart")||s[this.language].weekStart||0)%7,this.weekEnd=(this.weekStart+6)%7,this.startDate=-(1/0),this.endDate=1/0,this.daysOfWeekDisabled=[],this.setStartDate(i.startDate||this.element.data("date-startdate")),this.setEndDate(i.endDate||this.element.data("date-enddate")),this.setDaysOfWeekDisabled(i.daysOfWeekDisabled||this.element.data("date-days-of-week-disabled")),this.setMinutesDisabled(i.minutesDisabled||this.element.data("date-minute-disabled")),this.setHoursDisabled(i.hoursDisabled||this.element.data("date-hour-disabled")),this.fillDow(),this.fillMonths(),this.update(),this.showMode(),this.isInline&&this.show()};i.prototype={constructor:i,_events:[],_attachEvents:function(){this._detachEvents(),this.isInput?this._events=[[this.element,{focus:e.proxy(this.show,this),keyup:e.proxy(this.update,this),keydown:e.proxy(this.keydown,this)}]]:this.component&&this.hasInput?(this._events=[[this.element.find("input"),{focus:e.proxy(this.show,this),keyup:e.proxy(this.update,this),keydown:e.proxy(this.keydown,this)}],[this.component,{click:e.proxy(this.show,this)}]],this.componentReset&&this._events.push([this.componentReset,{click:e.proxy(this.reset,this)}])):this.element.is("div")?this.isInline=!0:this._events=[[this.element,{click:e.proxy(this.show,this)}]];for(var t,i,n=0;n<this._events.length;n++)t=this._events[n][0],i=this._events[n][1],t.on(i)},_detachEvents:function(){for(var e,t,i=0;i<this._events.length;i++)e=this._events[i][0],t=this._events[i][1],e.off(t);this._events=[]},show:function(t){this.picker.show(),this.height=this.component?this.component.outerHeight():this.element.outerHeight(),this.forceParse&&this.update(),this.place(),e(window).on("resize",e.proxy(this.place,this)),t&&(t.stopPropagation(),t.preventDefault()),this.isVisible=!0,this.element.trigger({type:"show",date:this.date})},hide:function(t){this.isVisible&&(this.isInline||(this.picker.hide(),e(window).off("resize",this.place),this.viewMode=this.startViewMode,this.showMode(),this.isInput||e(document).off("mousedown",this.hide),this.forceParse&&(this.isInput&&this.element.val()||this.hasInput&&this.element.find("input").val())&&this.setValue(),this.isVisible=!1,this.element.trigger({type:"hide",date:this.date})))},remove:function(){this._detachEvents(),e(document).off("mousedown",this.clickedOutside),this.picker.remove(),delete this.picker,delete this.element.data().datetimepicker},getDate:function(){var e=this.getUTCDate();return new Date(e.getTime()+6e4*e.getTimezoneOffset())},getUTCDate:function(){return this.date},setDate:function(e){this.setUTCDate(new Date(e.getTime()-6e4*e.getTimezoneOffset()))},setUTCDate:function(e){e>=this.startDate&&e<=this.endDate?(this.date=e,this.setValue(),this.viewDate=this.date,this.fill()):this.element.trigger({type:"outOfRange",date:e,startDate:this.startDate,endDate:this.endDate})},setFormat:function(e){this.format=r.parseFormat(e,this.formatType);var t;this.isInput?t=this.element:this.component&&(t=this.element.find("input")),t&&t.val()&&this.setValue()},setValue:function(){var t=this.getFormattedDate();this.isInput?this.element.val(t):(this.component&&this.element.find("input").val(t),this.element.data("date",t)),this.linkField&&e("#"+this.linkField).val(this.getFormattedDate(this.linkFormat))},getFormattedDate:function(e){return void 0==e&&(e=this.format),r.formatDate(this.date,e,this.language,this.formatType)},setStartDate:function(e){this.startDate=e||-(1/0),this.startDate!==-(1/0)&&(this.startDate=r.parseDate(this.startDate,this.format,this.language,this.formatType)),this.update(),this.updateNavArrows()},setEndDate:function(e){this.endDate=e||1/0,this.endDate!==1/0&&(this.endDate=r.parseDate(this.endDate,this.format,this.language,this.formatType)),this.update(),this.updateNavArrows()},setDaysOfWeekDisabled:function(t){this.daysOfWeekDisabled=t||[],e.isArray(this.daysOfWeekDisabled)||(this.daysOfWeekDisabled=this.daysOfWeekDisabled.split(/,\s*/)),this.daysOfWeekDisabled=e.map(this.daysOfWeekDisabled,function(e){return parseInt(e,10)}),this.update(),this.updateNavArrows()},setMinutesDisabled:function(t){this.minutesDisabled=t||[],e.isArray(this.minutesDisabled)||(this.minutesDisabled=this.minutesDisabled.split(/,\s*/)),this.minutesDisabled=e.map(this.minutesDisabled,function(e){return parseInt(e,10)}),this.update(),this.updateNavArrows()},setHoursDisabled:function(t){this.hoursDisabled=t||[],e.isArray(this.hoursDisabled)||(this.hoursDisabled=this.hoursDisabled.split(/,\s*/)),this.hoursDisabled=e.map(this.hoursDisabled,function(e){return parseInt(e,10)}),this.update(),this.updateNavArrows()},place:function(){if(!this.isInline){if(!this.zIndex){var t=0;e("div").each(function(){var i=parseInt(e(this).css("zIndex"),10);i>t&&(t=i)}),this.zIndex=t+10}var i,n,s,r;r=this.container instanceof e?this.container.offset():e(this.container).offset(),this.component?(i=this.component.offset(),s=i.left,"bottom-left"!=this.pickerPosition&&"top-left"!=this.pickerPosition||(s+=this.component.outerWidth()-this.picker.outerWidth())):(i=this.element.offset(),s=i.left);var a=document.body.clientWidth||window.innerWidth;s+220>a&&(s=a-220),n="top-left"==this.pickerPosition||"top-right"==this.pickerPosition?i.top-this.picker.outerHeight():i.top+this.height,n-=r.top,s-=r.left,this.picker.css({top:n,left:s,zIndex:this.zIndex})}},update:function(){var e,t=!1;arguments&&arguments.length&&("string"==typeof arguments[0]||arguments[0]instanceof Date)?(e=arguments[0],t=!0):(e=(this.isInput?this.element.val():this.element.find("input").val())||this.element.data("date")||this.initialDate,("string"==typeof e||e instanceof String)&&(e=e.replace(/^\s+|\s+$/g,""))),e||(e=new Date,t=!1),this.date=r.parseDate(e,this.format,this.language,this.formatType),t&&this.setValue(),this.date<this.startDate?this.viewDate=new Date(this.startDate):this.date>this.endDate?this.viewDate=new Date(this.endDate):this.viewDate=new Date(this.date),this.fill()},fillDow:function(){for(var e=this.weekStart,t="<tr>";e<this.weekStart+7;)t+='<th class="dow">'+s[this.language].daysMin[e++%7]+"</th>";t+="</tr>",this.picker.find(".datetimepicker-days thead").append(t)},fillMonths:function(){for(var e="",t=0;t<12;)e+='<span class="month">'+s[this.language].monthsShort[t++]+"</span>";this.picker.find(".datetimepicker-months td").html(e)},fill:function(){if(null!=this.date&&null!=this.viewDate){var i=new Date(this.viewDate),n=i.getUTCFullYear(),a=i.getUTCMonth(),o=i.getUTCDate(),h=i.getUTCHours(),l=i.getUTCMinutes(),d=this.startDate!==-(1/0)?this.startDate.getUTCFullYear():-(1/0),u=this.startDate!==-(1/0)?this.startDate.getUTCMonth()+1:-(1/0),c=this.endDate!==1/0?this.endDate.getUTCFullYear():1/0,p=this.endDate!==1/0?this.endDate.getUTCMonth()+1:1/0,f=new t(this.date.getUTCFullYear(),this.date.getUTCMonth(),this.date.getUTCDate()).valueOf(),m=new Date;if(this.picker.find(".datetimepicker-days thead th:eq(1)").text(s[this.language].months[a]+" "+n),"time"==this.formatViewType){var g=this.getFormattedDate();this.picker.find(".datetimepicker-hours thead th:eq(1)").text(g),this.picker.find(".datetimepicker-minutes thead th:eq(1)").text(g)}else this.picker.find(".datetimepicker-hours thead th:eq(1)").text(o+" "+s[this.language].months[a]+" "+n),this.picker.find(".datetimepicker-minutes thead th:eq(1)").text(o+" "+s[this.language].months[a]+" "+n);this.picker.find("tfoot th.today").text(s[this.language].today).toggle(this.todayBtn!==!1),this.updateNavArrows(),this.fillMonths();var v=t(n,a-1,28,0,0,0,0),w=r.getDaysInMonth(v.getUTCFullYear(),v.getUTCMonth());v.setUTCDate(w),v.setUTCDate(w-(v.getUTCDay()-this.weekStart+7)%7);var y=new Date(v);y.setUTCDate(y.getUTCDate()+42),y=y.valueOf();for(var b,D=[];v.valueOf()<y;)v.getUTCDay()==this.weekStart&&D.push("<tr>"),b="",v.getUTCFullYear()<n||v.getUTCFullYear()==n&&v.getUTCMonth()<a?b+=" old":(v.getUTCFullYear()>n||v.getUTCFullYear()==n&&v.getUTCMonth()>a)&&(b+=" new"),this.todayHighlight&&v.getUTCFullYear()==m.getFullYear()&&v.getUTCMonth()==m.getMonth()&&v.getUTCDate()==m.getDate()&&(b+=" today"),v.valueOf()==f&&(b+=" active"),(v.valueOf()+864e5<=this.startDate||v.valueOf()>this.endDate||e.inArray(v.getUTCDay(),this.daysOfWeekDisabled)!==-1)&&(b+=" disabled"),D.push('<td class="day'+b+'">'+v.getUTCDate()+"</td>"),v.getUTCDay()==this.weekEnd&&D.push("</tr>"),v.setUTCDate(v.getUTCDate()+1);this.picker.find(".datetimepicker-days tbody").empty().append(D.join("")),D=[];for(var T="",k="",_="",x=this.hoursDisabled||[],C=0;C<24;C++)if(x.indexOf(C)===-1){var M=t(n,a,o,C);b="",M.valueOf()+36e5<=this.startDate||M.valueOf()>this.endDate?b+=" disabled":h==C&&(b+=" active"),this.showMeridian&&2==s[this.language].meridiem.length?(k=C<12?s[this.language].meridiem[0]:s[this.language].meridiem[1],k!=_&&(""!=_&&D.push("</fieldset>"),D.push('<fieldset class="hour"><legend>'+k.toUpperCase()+"</legend>")),_=k,T=C%12?C%12:12,D.push('<span class="hour'+b+" hour_"+(C<12?"am":"pm")+'">'+T+"</span>"),23==C&&D.push("</fieldset>")):(T=C+":00",D.push('<span class="hour'+b+'">'+T+"</span>"))}this.picker.find(".datetimepicker-hours td").html(D.join("")),D=[],T="",k="",_="";for(var S=this.minutesDisabled||[],C=0;C<60;C+=this.minuteStep)if(S.indexOf(C)===-1){var M=t(n,a,o,h,C,0);b="",M.valueOf()<this.startDate||M.valueOf()>this.endDate?b+=" disabled":Math.floor(l/this.minuteStep)==Math.floor(C/this.minuteStep)&&(b+=" active"),this.showMeridian&&2==s[this.language].meridiem.length?(k=h<12?s[this.language].meridiem[0]:s[this.language].meridiem[1],k!=_&&(""!=_&&D.push("</fieldset>"),D.push('<fieldset class="minute"><legend>'+k.toUpperCase()+"</legend>")),_=k,T=h%12?h%12:12,D.push('<span class="minute'+b+'">'+T+":"+(C<10?"0"+C:C)+"</span>"),59==C&&D.push("</fieldset>")):(T=C+":00",D.push('<span class="minute'+b+'">'+h+":"+(C<10?"0"+C:C)+"</span>"))}this.picker.find(".datetimepicker-minutes td").html(D.join(""));var U=this.date.getUTCFullYear(),I=this.picker.find(".datetimepicker-months").find("th:eq(1)").text(n).end().find("span").removeClass("active");if(U==n){var F=I.length-12;I.eq(this.date.getUTCMonth()+F).addClass("active")}(n<d||n>c)&&I.addClass("disabled"),n==d&&I.slice(0,u+1).addClass("disabled"),n==c&&I.slice(p).addClass("disabled"),D="",n=10*parseInt(n/10,10);var R=this.picker.find(".datetimepicker-years").find("th:eq(1)").text(n+"-"+(n+9)).end().find("td");n-=1;for(var C=-1;C<11;C++)D+='<span class="year'+(C==-1||10==C?" old":"")+(U==n?" active":"")+(n<d||n>c?" disabled":"")+'">'+n+"</span>",n+=1;R.html(D),this.place()}},updateNavArrows:function(){var e=new Date(this.viewDate),t=e.getUTCFullYear(),i=e.getUTCMonth(),n=e.getUTCDate(),s=e.getUTCHours();switch(this.viewMode){case 0:this.startDate!==-(1/0)&&t<=this.startDate.getUTCFullYear()&&i<=this.startDate.getUTCMonth()&&n<=this.startDate.getUTCDate()&&s<=this.startDate.getUTCHours()?this.picker.find(".prev").css({visibility:"hidden"}):this.picker.find(".prev").css({visibility:"visible"}),this.endDate!==1/0&&t>=this.endDate.getUTCFullYear()&&i>=this.endDate.getUTCMonth()&&n>=this.endDate.getUTCDate()&&s>=this.endDate.getUTCHours()?this.picker.find(".next").css({visibility:"hidden"}):this.picker.find(".next").css({visibility:"visible"});break;case 1:this.startDate!==-(1/0)&&t<=this.startDate.getUTCFullYear()&&i<=this.startDate.getUTCMonth()&&n<=this.startDate.getUTCDate()?this.picker.find(".prev").css({visibility:"hidden"}):this.picker.find(".prev").css({visibility:"visible"}),this.endDate!==1/0&&t>=this.endDate.getUTCFullYear()&&i>=this.endDate.getUTCMonth()&&n>=this.endDate.getUTCDate()?this.picker.find(".next").css({visibility:"hidden"}):this.picker.find(".next").css({visibility:"visible"});break;case 2:this.startDate!==-(1/0)&&t<=this.startDate.getUTCFullYear()&&i<=this.startDate.getUTCMonth()?this.picker.find(".prev").css({visibility:"hidden"}):this.picker.find(".prev").css({visibility:"visible"}),this.endDate!==1/0&&t>=this.endDate.getUTCFullYear()&&i>=this.endDate.getUTCMonth()?this.picker.find(".next").css({visibility:"hidden"}):this.picker.find(".next").css({visibility:"visible"});break;case 3:case 4:this.startDate!==-(1/0)&&t<=this.startDate.getUTCFullYear()?this.picker.find(".prev").css({visibility:"hidden"}):this.picker.find(".prev").css({visibility:"visible"}),this.endDate!==1/0&&t>=this.endDate.getUTCFullYear()?this.picker.find(".next").css({visibility:"hidden"}):this.picker.find(".next").css({visibility:"visible"})}},mousewheel:function(t){if(t.preventDefault(),t.stopPropagation(),!this.wheelPause){this.wheelPause=!0;var i=t.originalEvent,n=i.wheelDelta,s=n>0?1:0===n?0:-1;this.wheelViewModeNavigationInverseDirection&&(s=-s),this.showMode(s),setTimeout(e.proxy(function(){this.wheelPause=!1},this),this.wheelViewModeNavigationDelay)}},click:function(i){i.stopPropagation(),i.preventDefault();var n=e(i.target).closest("span, td, th, legend");if(n.is("."+this.icontype)&&(n=e(n).parent().closest("span, td, th, legend")),1==n.length){if(n.is(".disabled"))return void this.element.trigger({type:"outOfRange",date:this.viewDate,startDate:this.startDate,endDate:this.endDate});switch(n[0].nodeName.toLowerCase()){case"th":switch(n[0].className){case"switch":this.showMode(1);break;case"prev":case"next":var s=r.modes[this.viewMode].navStep*("prev"==n[0].className?-1:1);switch(this.viewMode){case 0:this.viewDate=this.moveHour(this.viewDate,s);break;case 1:this.viewDate=this.moveDate(this.viewDate,s);break;case 2:this.viewDate=this.moveMonth(this.viewDate,s);break;case 3:case 4:this.viewDate=this.moveYear(this.viewDate,s)}this.fill(),this.element.trigger({type:n[0].className+":"+this.convertViewModeText(this.viewMode),date:this.viewDate,startDate:this.startDate,endDate:this.endDate});break;case"today":var a=new Date;a=t(a.getFullYear(),a.getMonth(),a.getDate(),a.getHours(),a.getMinutes(),a.getSeconds(),0),a<this.startDate?a=this.startDate:a>this.endDate&&(a=this.endDate),this.viewMode=this.startViewMode,this.showMode(0),this._setDate(a),this.fill(),this.autoclose&&this.hide()}break;case"span":if(!n.is(".disabled")){var o=this.viewDate.getUTCFullYear(),h=this.viewDate.getUTCMonth(),l=this.viewDate.getUTCDate(),d=this.viewDate.getUTCHours(),u=this.viewDate.getUTCMinutes(),c=this.viewDate.getUTCSeconds();if(n.is(".month")?(this.viewDate.setUTCDate(1),h=n.parent().find("span").index(n),l=this.viewDate.getUTCDate(),this.viewDate.setUTCMonth(h),this.element.trigger({type:"changeMonth",date:this.viewDate}),this.viewSelect>=3&&this._setDate(t(o,h,l,d,u,c,0))):n.is(".year")?(this.viewDate.setUTCDate(1),o=parseInt(n.text(),10)||0,this.viewDate.setUTCFullYear(o),this.element.trigger({type:"changeYear",date:this.viewDate}),this.viewSelect>=4&&this._setDate(t(o,h,l,d,u,c,0))):n.is(".hour")?(d=parseInt(n.text(),10)||0,(n.hasClass("hour_am")||n.hasClass("hour_pm"))&&(12==d&&n.hasClass("hour_am")?d=0:12!=d&&n.hasClass("hour_pm")&&(d+=12)),this.viewDate.setUTCHours(d),this.element.trigger({type:"changeHour",date:this.viewDate}),this.viewSelect>=1&&this._setDate(t(o,h,l,d,u,c,0))):n.is(".minute")&&(u=parseInt(n.text().substr(n.text().indexOf(":")+1),10)||0,this.viewDate.setUTCMinutes(u),this.element.trigger({type:"changeMinute",date:this.viewDate}),this.viewSelect>=0&&this._setDate(t(o,h,l,d,u,c,0))),0!=this.viewMode){var p=this.viewMode;this.showMode(-1),this.fill(),p==this.viewMode&&this.autoclose&&this.hide()}else this.fill(),this.autoclose&&this.hide()}break;case"td":if(n.is(".day")&&!n.is(".disabled")){var l=parseInt(n.text(),10)||1,o=this.viewDate.getUTCFullYear(),h=this.viewDate.getUTCMonth(),d=this.viewDate.getUTCHours(),u=this.viewDate.getUTCMinutes(),c=this.viewDate.getUTCSeconds();n.is(".old")?0===h?(h=11,o-=1):h-=1:n.is(".new")&&(11==h?(h=0,o+=1):h+=1),this.viewDate.setUTCFullYear(o),this.viewDate.setUTCMonth(h,l),this.element.trigger({type:"changeDay",date:this.viewDate}),this.viewSelect>=2&&this._setDate(t(o,h,l,d,u,c,0))}var p=this.viewMode;this.showMode(-1),this.fill(),p==this.viewMode&&this.autoclose&&this.hide()}}},_setDate:function(e,t){t&&"date"!=t||(this.date=e),t&&"view"!=t||(this.viewDate=e),this.fill(),this.setValue();var i;this.isInput?i=this.element:this.component&&(i=this.element.find("input")),i&&(i.change(),this.autoclose&&(!t||"date"==t)),this.element.trigger({type:"changeDate",date:this.date}),null==e&&(this.date=this.viewDate)},moveMinute:function(e,t){if(!t)return e;var i=new Date(e.valueOf());return i.setUTCMinutes(i.getUTCMinutes()+t*this.minuteStep),i},moveHour:function(e,t){if(!t)return e;var i=new Date(e.valueOf());return i.setUTCHours(i.getUTCHours()+t),i},moveDate:function(e,t){if(!t)return e;var i=new Date(e.valueOf());return i.setUTCDate(i.getUTCDate()+t),i},moveMonth:function(e,t){if(!t)return e;var i,n,s=new Date(e.valueOf()),r=s.getUTCDate(),a=s.getUTCMonth(),o=Math.abs(t);if(t=t>0?1:-1,1==o)n=t==-1?function(){return s.getUTCMonth()==a}:function(){return s.getUTCMonth()!=i},i=a+t,s.setUTCMonth(i),(i<0||i>11)&&(i=(i+12)%12);else{for(var h=0;h<o;h++)s=this.moveMonth(s,t);i=s.getUTCMonth(),s.setUTCDate(r),n=function(){return i!=s.getUTCMonth()}}for(;n();)s.setUTCDate(--r),s.setUTCMonth(i);return s},moveYear:function(e,t){return this.moveMonth(e,12*t)},dateWithinRange:function(e){return e>=this.startDate&&e<=this.endDate},keydown:function(e){if(this.picker.is(":not(:visible)"))return void(27==e.keyCode&&this.show());var t,i,n,s=!1;switch(e.keyCode){case 27:this.hide(),e.preventDefault();break;case 37:case 39:if(!this.keyboardNavigation)break;t=37==e.keyCode?-1:1,viewMode=this.viewMode,e.ctrlKey?viewMode+=2:e.shiftKey&&(viewMode+=1),4==viewMode?(i=this.moveYear(this.date,t),n=this.moveYear(this.viewDate,t)):3==viewMode?(i=this.moveMonth(this.date,t),n=this.moveMonth(this.viewDate,t)):2==viewMode?(i=this.moveDate(this.date,t),n=this.moveDate(this.viewDate,t)):1==viewMode?(i=this.moveHour(this.date,t),n=this.moveHour(this.viewDate,t)):0==viewMode&&(i=this.moveMinute(this.date,t),n=this.moveMinute(this.viewDate,t)),this.dateWithinRange(i)&&(this.date=i,this.viewDate=n,this.setValue(),this.update(),e.preventDefault(),s=!0);break;case 38:case 40:if(!this.keyboardNavigation)break;t=38==e.keyCode?-1:1,viewMode=this.viewMode,e.ctrlKey?viewMode+=2:e.shiftKey&&(viewMode+=1),4==viewMode?(i=this.moveYear(this.date,t),n=this.moveYear(this.viewDate,t)):3==viewMode?(i=this.moveMonth(this.date,t),n=this.moveMonth(this.viewDate,t)):2==viewMode?(i=this.moveDate(this.date,7*t),n=this.moveDate(this.viewDate,7*t)):1==viewMode?this.showMeridian?(i=this.moveHour(this.date,6*t),n=this.moveHour(this.viewDate,6*t)):(i=this.moveHour(this.date,4*t),n=this.moveHour(this.viewDate,4*t)):0==viewMode&&(i=this.moveMinute(this.date,4*t),n=this.moveMinute(this.viewDate,4*t)),this.dateWithinRange(i)&&(this.date=i,this.viewDate=n,this.setValue(),this.update(),e.preventDefault(),s=!0);break;case 13:if(0!=this.viewMode){var r=this.viewMode;this.showMode(-1),this.fill(),r==this.viewMode&&this.autoclose&&this.hide()}else this.fill(),this.autoclose&&this.hide();e.preventDefault();break;case 9:this.hide()}if(s){var a;this.isInput?a=this.element:this.component&&(a=this.element.find("input")),a&&a.change(),this.element.trigger({type:"changeDate",date:this.date})}},showMode:function(e){if(e){var t=Math.max(0,Math.min(r.modes.length-1,this.viewMode+e));t>=this.minView&&t<=this.maxView&&(this.element.trigger({type:"changeMode",date:this.viewDate,oldViewMode:this.viewMode,newViewMode:t}),this.viewMode=t)}this.picker.find(">div").hide().filter(".datetimepicker-"+r.modes[this.viewMode].clsName).css("display","block"),this.updateNavArrows()},reset:function(e){this._setDate(null,"date")},convertViewModeText:function(e){switch(e){case 4:return"decade";case 3:return"year";case 2:return"month";case 1:return"day";case 0:return"hour"}}};var n=e.fn.datetimepicker;e.fn.datetimepicker=function(t){var n=Array.apply(null,arguments);n.shift();var s;return this.each(function(){var r=e(this),a=r.data("datetimepicker"),o="object"==typeof t&&t;if(a||r.data("datetimepicker",a=new i(this,e.extend({},e.fn.datetimepicker.defaults,o))),"string"==typeof t&&"function"==typeof a[t]&&(s=a[t].apply(a,n),void 0!==s))return!1}),void 0!==s?s:this},e.fn.datetimepicker.defaults={},e.fn.datetimepicker.Constructor=i;var s=e.fn.datetimepicker.dates={en:{days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"],daysShort:["Sun","Mon","Tue","Wed","Thu","Fri","Sat","Sun"],daysMin:["Su","Mo","Tu","We","Th","Fr","Sa","Su"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],monthsShort:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],meridiem:["am","pm"],suffix:["st","nd","rd","th"],today:"Today"}},r={modes:[{clsName:"minutes",navFnc:"Hours",navStep:1},{clsName:"hours",navFnc:"Date",navStep:1},{clsName:"days",navFnc:"Month",navStep:1},{clsName:"months",navFnc:"FullYear",navStep:1},{clsName:"years",navFnc:"FullYear",navStep:10}],isLeapYear:function(e){return e%4===0&&e%100!==0||e%400===0},getDaysInMonth:function(e,t){return[31,r.isLeapYear(e)?29:28,31,30,31,30,31,31,30,31,30,31][t]},getDefaultFormat:function(e,t){if("standard"==e)return"input"==t?"yyyy-mm-dd hh:ii":"yyyy-mm-dd hh:ii:ss";if("php"==e)return"input"==t?"Y-m-d H:i":"Y-m-d H:i:s";throw new Error("Invalid format type.")},validParts:function(e){if("standard"==e)return/hh?|HH?|p|P|ii?|ss?|dd?|DD?|mm?|MM?|yy(?:yy)?/g;if("php"==e)return/[dDjlNwzFmMnStyYaABgGhHis]/g;throw new Error("Invalid format type.")},nonpunctuation:/[^ -\/:-@\[-`{-~\t\n\rTZ]+/g,parseFormat:function(e,t){var i=e.replace(this.validParts(t),"\0").split("\0"),n=e.match(this.validParts(t));if(!i||!i.length||!n||0==n.length)throw new Error("Invalid date format.");return{separators:i,parts:n}},parseDate:function(n,r,a,o){if(n instanceof Date){var h=new Date(n.valueOf()-6e4*n.getTimezoneOffset());return h.setMilliseconds(0),h}if(/^\d{4}\-\d{1,2}\-\d{1,2}$/.test(n)&&(r=this.parseFormat("yyyy-mm-dd",o)),/^\d{4}\-\d{1,2}\-\d{1,2}[T ]\d{1,2}\:\d{1,2}$/.test(n)&&(r=this.parseFormat("yyyy-mm-dd hh:ii",o)),/^\d{4}\-\d{1,2}\-\d{1,2}[T ]\d{1,2}\:\d{1,2}\:\d{1,2}[Z]{0,1}$/.test(n)&&(r=this.parseFormat("yyyy-mm-dd hh:ii:ss",o)),/^[-+]\d+[dmwy]([\s,]+[-+]\d+[dmwy])*$/.test(n)){var l,d,u=/([-+]\d+)([dmwy])/,c=n.match(/([-+]\d+)([dmwy])/g);n=new Date;for(var p=0;p<c.length;p++)switch(l=u.exec(c[p]),d=parseInt(l[1]),l[2]){case"d":n.setUTCDate(n.getUTCDate()+d);break;case"m":n=i.prototype.moveMonth.call(i.prototype,n,d);break;case"w":n.setUTCDate(n.getUTCDate()+7*d);break;case"y":n=i.prototype.moveYear.call(i.prototype,n,d)}return t(n.getUTCFullYear(),n.getUTCMonth(),n.getUTCDate(),n.getUTCHours(),n.getUTCMinutes(),n.getUTCSeconds(),0)}var f,m,l,c=n&&n.toString().match(this.nonpunctuation)||[],n=new Date(0,0,0,0,0,0,0),g={},v=["hh","h","ii","i","ss","s","yyyy","yy","M","MM","m","mm","D","DD","d","dd","H","HH","p","P"],w={hh:function(e,t){return e.setUTCHours(t)},h:function(e,t){return e.setUTCHours(t)},HH:function(e,t){return e.setUTCHours(12==t?0:t)},H:function(e,t){return e.setUTCHours(12==t?0:t)},ii:function(e,t){return e.setUTCMinutes(t)},i:function(e,t){return e.setUTCMinutes(t)},ss:function(e,t){return e.setUTCSeconds(t)},s:function(e,t){return e.setUTCSeconds(t)},yyyy:function(e,t){return e.setUTCFullYear(t)},yy:function(e,t){return e.setUTCFullYear(2e3+t)},m:function(e,t){for(t-=1;t<0;)t+=12;for(t%=12,e.setUTCMonth(t);e.getUTCMonth()!=t;){if(isNaN(e.getUTCMonth()))return e;e.setUTCDate(e.getUTCDate()-1)}return e},d:function(e,t){return e.setUTCDate(t)},p:function(e,t){return e.setUTCHours(1==t?e.getUTCHours()+12:e.getUTCHours())}};if(w.M=w.MM=w.mm=w.m,w.dd=w.d,w.P=w.p,n=t(n.getFullYear(),n.getMonth(),n.getDate(),n.getHours(),n.getMinutes(),n.getSeconds()),c.length==r.parts.length){for(var p=0,y=r.parts.length;p<y;p++){if(f=parseInt(c[p],10),l=r.parts[p],isNaN(f))switch(l){case"MM":m=e(s[a].months).filter(function(){var e=this.slice(0,c[p].length),t=c[p].slice(0,e.length);return e==t}),f=e.inArray(m[0],s[a].months)+1;break;case"M":m=e(s[a].monthsShort).filter(function(){var e=this.slice(0,c[p].length),t=c[p].slice(0,e.length);return e.toLowerCase()==t.toLowerCase()}),f=e.inArray(m[0],s[a].monthsShort)+1;break;case"p":case"P":f=e.inArray(c[p].toLowerCase(),s[a].meridiem)}g[l]=f}for(var b,p=0;p<v.length;p++)b=v[p],b in g&&!isNaN(g[b])&&w[b](n,g[b])}return n},formatDate:function(t,i,n,a){if(null==t)return"";var o;if("standard"==a)o={yy:t.getUTCFullYear().toString().substring(2),yyyy:t.getUTCFullYear(),m:t.getUTCMonth()+1,M:s[n].monthsShort[t.getUTCMonth()],MM:s[n].months[t.getUTCMonth()],d:t.getUTCDate(),D:s[n].daysShort[t.getUTCDay()],DD:s[n].days[t.getUTCDay()],p:2==s[n].meridiem.length?s[n].meridiem[t.getUTCHours()<12?0:1]:"",h:t.getUTCHours(),i:t.getUTCMinutes(),s:t.getUTCSeconds()},2==s[n].meridiem.length?o.H=o.h%12==0?12:o.h%12:o.H=o.h,o.HH=(o.H<10?"0":"")+o.H,o.P=o.p.toUpperCase(),o.hh=(o.h<10?"0":"")+o.h,o.ii=(o.i<10?"0":"")+o.i,o.ss=(o.s<10?"0":"")+o.s,o.dd=(o.d<10?"0":"")+o.d,o.mm=(o.m<10?"0":"")+o.m;else{if("php"!=a)throw new Error("Invalid format type.");o={y:t.getUTCFullYear().toString().substring(2),Y:t.getUTCFullYear(),F:s[n].months[t.getUTCMonth()],M:s[n].monthsShort[t.getUTCMonth()],n:t.getUTCMonth()+1,t:r.getDaysInMonth(t.getUTCFullYear(),t.getUTCMonth()),j:t.getUTCDate(),l:s[n].days[t.getUTCDay()],D:s[n].daysShort[t.getUTCDay()],w:t.getUTCDay(),N:0==t.getUTCDay()?7:t.getUTCDay(),S:t.getUTCDate()%10<=s[n].suffix.length?s[n].suffix[t.getUTCDate()%10-1]:"",a:2==s[n].meridiem.length?s[n].meridiem[t.getUTCHours()<12?0:1]:"",g:t.getUTCHours()%12==0?12:t.getUTCHours()%12,
G:t.getUTCHours(),i:t.getUTCMinutes(),s:t.getUTCSeconds()},o.m=(o.n<10?"0":"")+o.n,o.d=(o.j<10?"0":"")+o.j,o.A=o.a.toString().toUpperCase(),o.h=(o.g<10?"0":"")+o.g,o.H=(o.G<10?"0":"")+o.G,o.i=(o.i<10?"0":"")+o.i,o.s=(o.s<10?"0":"")+o.s}for(var t=[],h=e.extend([],i.separators),l=0,d=i.parts.length;l<d;l++)h.length&&t.push(h.shift()),t.push(o[i.parts[l]]);return h.length&&t.push(h.shift()),t.join("")},convertViewMode:function(e){switch(e){case 4:case"decade":e=4;break;case 3:case"year":e=3;break;case 2:case"month":e=2;break;case 1:case"day":e=1;break;case 0:case"hour":e=0}return e},headTemplate:'<thead><tr><th class="prev"><i class="{iconType} {leftArrow}"/></th><th colspan="5" class="switch"></th><th class="next"><i class="{iconType} {rightArrow}"/></th></tr></thead>',headTemplateV3:'<thead><tr><th class="prev"><span class="{iconType} {leftArrow}"></span> </th><th colspan="5" class="switch"></th><th class="next"><span class="{iconType} {rightArrow}"></span> </th></tr></thead>',contTemplate:'<tbody><tr><td colspan="7"></td></tr></tbody>',footTemplate:'<tfoot><tr><th colspan="7" class="today"></th></tr></tfoot>'};r.template='<div class="datetimepicker"><div class="datetimepicker-minutes"><table class=" table-condensed">'+r.headTemplate+r.contTemplate+r.footTemplate+'</table></div><div class="datetimepicker-hours"><table class=" table-condensed">'+r.headTemplate+r.contTemplate+r.footTemplate+'</table></div><div class="datetimepicker-days"><table class=" table-condensed">'+r.headTemplate+"<tbody></tbody>"+r.footTemplate+'</table></div><div class="datetimepicker-months"><table class="table-condensed">'+r.headTemplate+r.contTemplate+r.footTemplate+'</table></div><div class="datetimepicker-years"><table class="table-condensed">'+r.headTemplate+r.contTemplate+r.footTemplate+"</table></div></div>",r.templateV3='<div class="datetimepicker"><div class="datetimepicker-minutes"><table class=" table-condensed">'+r.headTemplateV3+r.contTemplate+r.footTemplate+'</table></div><div class="datetimepicker-hours"><table class=" table-condensed">'+r.headTemplateV3+r.contTemplate+r.footTemplate+'</table></div><div class="datetimepicker-days"><table class=" table-condensed">'+r.headTemplateV3+"<tbody></tbody>"+r.footTemplate+'</table></div><div class="datetimepicker-months"><table class="table-condensed">'+r.headTemplateV3+r.contTemplate+r.footTemplate+'</table></div><div class="datetimepicker-years"><table class="table-condensed">'+r.headTemplateV3+r.contTemplate+r.footTemplate+"</table></div></div>",e.fn.datetimepicker.DPGlobal=r,e.fn.datetimepicker.noConflict=function(){return e.fn.datetimepicker=n,this},e(document).on("focus.datetimepicker.data-api click.datetimepicker.data-api",'[data-provide="datetimepicker"]',function(t){var i=e(this);i.data("datetimepicker")||(t.preventDefault(),i.datetimepicker("show"))}),e(function(){e('[data-provide="datetimepicker-inline"]').datetimepicker()})}(window.jQuery),function(e){e.fn.datetimepicker.dates["zh-CN"]={days:["星期日","星期一","星期二","星期三","星期四","星期五","星期六","星期日"],daysShort:["周日","周一","周二","周三","周四","周五","周六","周日"],daysMin:["日","一","二","三","四","五","六","日"],months:["一月","二月","三月","四月","五月","六月","七月","八月","九月","十月","十一","十二"],monthsShort:["一月","二月","三月","四月","五月","六月","七月","八月","九月","十月","十一","十二"],today:"今天",suffix:[],meridiem:["上午","下午"]}}(jQuery),function(e){e.fn.citySelect=function(t){if(!(this.length<1)){t=e.extend({url:"",prov:null,city:null,dist:null,nodata:null,required:!0},t);var i,n=this,s=n.find(".prov"),r=n.find(".city"),a=n.find(".dist"),o=(t.prov,t.city,t.dist,t.required?"":"<option value=''>请选择</option>"),h=function(){var n=s.get(0).selectedIndex;return t.required||n--,r.empty().attr("disabled",!0),a.empty().attr("disabled",!0),n<0||"undefined"==typeof i.citylist[n].c?void("none"==t.nodata?(r.css("display","none"),a.css("display","none")):"hidden"==t.nodata&&(r.css("visibility","hidden"),a.css("visibility","hidden"))):(temp_html=o,e.each(i.citylist[n].c,function(e,t){t.n.key?temp_html+="<option value='"+t.n.key+"'>"+t.n.value+"</option>":temp_html+="<option value='"+t.n+"'>"+t.n+"</option>"}),r.html(temp_html).attr("disabled",!1).css({display:"",visibility:""}),void l())},l=function(){var n=s.get(0).selectedIndex,h=r.get(0).selectedIndex;return t.required||(n--,h--),a.empty().attr("disabled",!0),n<0||h<0||"undefined"==typeof i.citylist[n].c[h].a?void("none"==t.nodata?a.css("display","none"):"hidden"==t.nodata&&a.css("visibility","hidden")):(temp_html=o,e.each(i.citylist[n].c[h].a,function(e,t){t.s.key?temp_html+="<option value='"+t.s.key+"'>"+t.s.value+"</option>":temp_html+="<option value='"+t.s+"'>"+t.s+"</option>"}),void a.html(temp_html).attr("disabled",!1).css({display:"",visibility:""}))},d=function(){temp_html=o,e.each(i.citylist,function(e,t){t.p.key?temp_html+="<option value='"+t.p.key+"'>"+t.p.value+"</option>":temp_html+="<option value='"+t.p+"'>"+t.p+"</option>"}),s.html(temp_html),setTimeout(function(){null!=t.prov&&(s.val(t.prov),h(),setTimeout(function(){null!=t.city&&(r.val(t.city),l(),setTimeout(function(){null!=t.dist&&a.val(t.dist)},1))},1))},1),s.bind("change",function(){h()}),r.bind("change",function(){l()})};"string"==typeof t.url?e.getJSON(t.url,function(e){i=e,d()}):(i=t.url,d())}}}(jQuery),function(e){e.fn.dragsort=function(t){if("destroy"==t)return void e(this.selector).trigger("dragsort-uninit");var i=e.extend({},e.fn.dragsort.defaults,t),n=[],s=null,r=null;return this.each(function(t,a){e(a).is("table")&&1==e(a).children().size()&&e(a).children().is("tbody")&&(a=e(a).children().get(0));var o={draggedItem:null,placeHolderItem:null,pos:null,offset:null,offsetLimit:null,scroll:null,container:a,init:function(){i.tagName=0==e(this.container).children().size()?"li":e(this.container).children().get(0).tagName.toLowerCase(),""==i.itemSelector&&(i.itemSelector=i.tagName),""==i.dragSelector&&(i.dragSelector=i.tagName),""==i.placeHolderTemplate&&(i.placeHolderTemplate="<"+i.tagName+">&nbsp;</"+i.tagName+">"),e(this.container).attr("data-listidx",t).mousedown(this.grabItem).bind("dragsort-uninit",this.uninit),this.styleDragHandlers(!0)},uninit:function(){var t=n[e(this).attr("data-listidx")];e(t.container).unbind("mousedown",t.grabItem).unbind("dragsort-uninit"),t.styleDragHandlers(!1)},getItems:function(){return e(this.container).children(i.itemSelector)},styleDragHandlers:function(t){this.getItems().map(function(){return e(this).is(i.dragSelector)?this:e(this).find(i.dragSelector).get()}).css("cursor",t?"pointer":"")},grabItem:function(t){var s=n[e(this).attr("data-listidx")],r=e(t.target).closest("[data-listidx] > "+i.tagName).get(0),a=s.getItems().filter(function(){return this==r}).size()>0;if(!(1!=t.which||e(t.target).is(i.dragSelectorExclude)||e(t.target).closest(i.dragSelectorExclude).size()>0)&&a){t.preventDefault();for(var o=t.target;!e(o).is(i.dragSelector);){if(o==this)return;o=o.parentNode}e(o).attr("data-cursor",e(o).css("cursor")),e(o).css("cursor","move");var h=this,l=function(){s.dragStart.call(h,t),e(s.container).unbind("mousemove",l)};e(s.container).mousemove(l).mouseup(function(){e(s.container).unbind("mousemove",l),e(o).css("cursor",e(o).attr("data-cursor"))})}},dragStart:function(t){if(null!=s&&null!=s.draggedItem&&s.dropItem(),s=n[e(this).attr("data-listidx")],s.draggedItem=e(t.target).closest("[data-listidx] > "+i.tagName),i.dragStart.apply(s.draggedItem)===!1)return void(s.draggedItem=null);s.draggedItem.attr("data-origpos",e(this).attr("data-listidx")+"-"+e(s.container).children().index(s.draggedItem));var r=parseInt(s.draggedItem.css("marginTop")),a=parseInt(s.draggedItem.css("marginLeft"));if(s.offset=s.draggedItem.offset(),s.offset.top=t.pageY-s.offset.top+(isNaN(r)?0:r)-1,s.offset.left=t.pageX-s.offset.left+(isNaN(a)?0:a)-1,!i.dragBetween){var o=0==e(s.container).outerHeight()?Math.max(1,Math.round(.5+s.getItems().size()*s.draggedItem.outerWidth()/e(s.container).outerWidth()))*s.draggedItem.outerHeight():e(s.container).outerHeight();s.offsetLimit=e(s.container).offset(),s.offsetLimit.right=s.offsetLimit.left+e(s.container).outerWidth()-s.draggedItem.outerWidth(),s.offsetLimit.bottom=s.offsetLimit.top+o-s.draggedItem.outerHeight()}var h=s.draggedItem.height(),l=s.draggedItem.width();if("tr"==i.tagName?(s.draggedItem.children().each(function(){e(this).width(e(this).width())}),s.placeHolderItem=s.draggedItem.clone().attr("data-placeholder",!0),s.draggedItem.after(s.placeHolderItem),s.placeHolderItem.children().each(function(){e(this).css({borderWidth:0,width:e(this).width()+1,height:e(this).height()+1}).html("&nbsp;")})):(s.draggedItem.after(i.placeHolderTemplate),s.placeHolderItem=s.draggedItem.next().css({height:h,width:l}).attr("data-placeholder",!0)),"td"==i.tagName){var d=s.draggedItem.closest("table").get(0);e("<table id='"+d.id+"' style='border-width: 0px;' class='dragSortItem "+d.className+"'><tr></tr></table>").appendTo("body").children().append(s.draggedItem)}var u=s.draggedItem.attr("style");s.draggedItem.attr("data-origstyle",u?u:""),s.draggedItem.css({position:"absolute",opacity:.8,"z-index":999,height:h,width:l}),s.scroll={moveX:0,moveY:0,maxX:e(document).width()-e(window).width(),maxY:e(document).height()-e(window).height()},s.scroll.scrollY=window.setInterval(function(){if(i.scrollContainer!=window)return void e(i.scrollContainer).scrollTop(e(i.scrollContainer).scrollTop()+s.scroll.moveY);var t=e(i.scrollContainer).scrollTop();(s.scroll.moveY>0&&t<s.scroll.maxY||s.scroll.moveY<0&&t>0)&&(e(i.scrollContainer).scrollTop(t+s.scroll.moveY),s.draggedItem.css("top",s.draggedItem.offset().top+s.scroll.moveY+1))},10),s.scroll.scrollX=window.setInterval(function(){if(i.scrollContainer!=window)return void e(i.scrollContainer).scrollLeft(e(i.scrollContainer).scrollLeft()+s.scroll.moveX);var t=e(i.scrollContainer).scrollLeft();(s.scroll.moveX>0&&t<s.scroll.maxX||s.scroll.moveX<0&&t>0)&&(e(i.scrollContainer).scrollLeft(t+s.scroll.moveX),s.draggedItem.css("left",s.draggedItem.offset().left+s.scroll.moveX+1))},10),e(n).each(function(e,t){t.createDropTargets(),t.buildPositionTable()}),s.setPos(t.pageX,t.pageY),e(document).bind("mousemove",s.swapItems),e(document).bind("mouseup",s.dropItem),i.scrollContainer!=window&&e(window).bind("DOMMouseScroll mousewheel",s.wheel)},setPos:function(t,n){var r=n-this.offset.top,a=t-this.offset.left;i.dragBetween||(r=Math.min(this.offsetLimit.bottom,Math.max(r,this.offsetLimit.top)),a=Math.min(this.offsetLimit.right,Math.max(a,this.offsetLimit.left)));var o=this.draggedItem.offsetParent().not("body").offset();if(null!=o&&(r-=o.top,a-=o.left),i.scrollContainer==window)n-=e(window).scrollTop(),t-=e(window).scrollLeft(),n=Math.max(0,n-e(window).height()+5)+Math.min(0,n-5),t=Math.max(0,t-e(window).width()+5)+Math.min(0,t-5);else{var h=e(i.scrollContainer),l=h.offset();n=Math.max(0,n-h.height()-l.top)+Math.min(0,n-l.top),t=Math.max(0,t-h.width()-l.left)+Math.min(0,t-l.left)}s.scroll.moveX=0==t?0:t*i.scrollSpeed/Math.abs(t),s.scroll.moveY=0==n?0:n*i.scrollSpeed/Math.abs(n),this.draggedItem.css({top:r,left:a})},wheel:function(t){if((e.browser.safari||e.browser.mozilla)&&s&&i.scrollContainer!=window){var n=e(i.scrollContainer),r=n.offset();if(t.pageX>r.left&&t.pageX<r.left+n.width()&&t.pageY>r.top&&t.pageY<r.top+n.height()){var a=t.detail?5*t.detail:t.wheelDelta/-2;n.scrollTop(n.scrollTop()+a),t.preventDefault()}}},buildPositionTable:function(){var t=[];this.getItems().not([s.draggedItem[0],s.placeHolderItem[0]]).each(function(i){var n=e(this).offset();n.right=n.left+e(this).outerWidth(),n.bottom=n.top+e(this).outerHeight(),n.elm=this,t[i]=n}),this.pos=t},dropItem:function(){if(null!=s.draggedItem){var t=s.draggedItem.attr("data-origstyle");if(s.draggedItem.attr("style",t),""==t&&s.draggedItem.removeAttr("style"),s.draggedItem.removeAttr("data-origstyle"),s.styleDragHandlers(!0),s.placeHolderItem.before(s.draggedItem),s.placeHolderItem.remove(),e("[data-droptarget], .dragSortItem").remove(),window.clearInterval(s.scroll.scrollY),window.clearInterval(s.scroll.scrollX),s.draggedItem.attr("data-origpos")!=e(n).index(s)+"-"+e(s.container).children().index(s.draggedItem)&&0==i.dragEnd.apply(s.draggedItem)){var r=s.draggedItem.attr("data-origpos").split("-"),a=e(n[r[0]].container).children().not(s.draggedItem).eq(r[1]);a.size()>0?a.before(s.draggedItem):0==r[1]?e(n[r[0]].container).prepend(s.draggedItem):e(n[r[0]].container).append(s.draggedItem)}return s.draggedItem.removeAttr("data-origpos"),s.draggedItem=null,e(document).unbind("mousemove",s.swapItems),e(document).unbind("mouseup",s.dropItem),i.scrollContainer!=window&&e(window).unbind("DOMMouseScroll mousewheel",s.wheel),!1}},swapItems:function(t){if(null==s.draggedItem)return!1;s.setPos(t.pageX,t.pageY);for(var a=s.findPos(t.pageX,t.pageY),o=s,h=0;a==-1&&i.dragBetween&&h<n.length;h++)a=n[h].findPos(t.pageX,t.pageY),o=n[h];if(a==-1)return!1;var l=function(){return e(o.container).children().not(o.draggedItem)},d=l().not(i.itemSelector).each(function(e){this.idx=l().index(this)});return null==r||r.top>s.draggedItem.offset().top||r.left>s.draggedItem.offset().left?e(o.pos[a].elm).before(s.placeHolderItem):e(o.pos[a].elm).after(s.placeHolderItem),d.each(function(){var t=l().eq(this.idx).get(0);this!=t&&l().index(this)<this.idx?e(this).insertAfter(t):this!=t&&e(this).insertBefore(t)}),e(n).each(function(e,t){t.createDropTargets(),t.buildPositionTable()}),r=s.draggedItem.offset(),!1},findPos:function(e,t){for(var i=0;i<this.pos.length;i++)if(this.pos[i].left<e&&this.pos[i].right>e&&this.pos[i].top<t&&this.pos[i].bottom>t)return i;return-1},createDropTargets:function(){i.dragBetween&&e(n).each(function(){var t=e(this.container).find("[data-placeholder]"),n=e(this.container).find("[data-droptarget]");t.size()>0&&n.size()>0?n.remove():0==t.size()&&0==n.size()&&("td"==i.tagName?e(i.placeHolderTemplate).attr("data-droptarget",!0).appendTo(this.container):e(this.container).append(s.placeHolderItem.removeAttr("data-placeholder").clone().attr("data-droptarget",!0)),s.placeHolderItem.attr("data-placeholder",!0))})}};o.init(),n.push(o)}),this},e.fn.dragsort.defaults={itemSelector:"",dragSelector:"",dragSelectorExclude:"input, textarea",dragStart:function(){},dragEnd:function(){},dragBetween:!1,placeHolderTemplate:"",scrollContainer:window,scrollSpeed:5}}(jQuery),function($){$.fn.iconpicker=function(options){var self=this;return this.buttonSize="sm",this.columns=10,this.height=400,this.extend(options),this.open=!1,this.allowedSizes=["sm","lg","2x","3x","4x","5x"],this.templates={filter:"<div class='row'><div class='col-xs-12 form-group'><div class='icon-filter-box input-group'><span class='input-group-addon'>Filter: </span><input type='text' class='icon-filter form-control'></div></div></div>",sizes:"<div class='row'><div class='col-xs-12 btn-group'><a class='btn btn-default' href='#' data-size='sm'>SM</a><a class='btn btn-default' href='#' data-size='lg'>LG</a><a class='btn btn-default' href='#' data-size='2x'>2X</a><a class='btn btn-default' href='#' data-size='3x'>3X</a><a class='btn btn-default' href='#' data-size='4x'>4X</a><a class='btn btn-default' href='#' data-size='5x'>5X</a></div></div>"},this.icons=options.icons,$(this).on("click",function(e){self.$el=$(e.currentTarget),$(e.currentTarget).find(".icon-menu").length?self.closeMenu():self.openMenu()}),$(this).on("click",".icon",function(e){e.stopPropagation();var t=$(e.currentTarget).data("icon");void 0!==self.clickCallback?self.clickCallback(t):self.$el.find("> .form-control").val(t).focus().select(),self.closeMenu()}),$(this).on("click",".icon-menu",function(e){e.stopPropagation()}),$(this).on("keyup",".icon-filter",function(e){var t=$(e.target).val();self.doFilter(t)}),$(this).on("click",".btn-group .btn",function(e){var t="sm"==$(e.currentTarget).data("size")?"":"fa-"+$(e.currentTarget).data("size");self.$sizeSelector.find(".btn").removeClass("active"),$(e.currentTarget).addClass("active"),self.$container.find("i").removeClass("fa-lg fa-2x fa-3x fa-4x fa-5x").addClass(t),self.resize()}),this.createMenu=function(){this.icons=eval(this.icons),this.$menu=$("<div>",{"class":"icon-menu",style:"height:"+this.height+"px"}),this.filter!==!1&&(this.$filter=$(this.templates.filter),this.$menu.append(this.$filter)),this.sizeSelector!==!1&&(this.$sizeSelector=$(this.templates.sizes),this.$sizeSelector.find("a[data-size="+this.buttonSize+"]").addClass("active"),this.$menu.append(this.$sizeSelector)),this.$container=$("<div>",{"class":"icon-container",style:"height:"+this.innerHeight+"px"});for(var i in this.icons){var size=$.inArray(this.buttonSize,this.allowedSizes)>-1?" fa-"+this.buttonSize:"",button=$("<a>",{"class":"icon",title:this.icons[i].name,"data-icon":this.icons[i].selector,"data-filter":this.icons[i].filter});button.html("<i class='fa fa-fw "+this.icons[i].selector+size+"'></i>"),this.$container.append(button)}this.$menu.append(this.$container)},this.openMenu=function(e){this.open=!0,$(this.$el).append(this.$menu),this.resize(),this.$menu.find(".icon-filter").focus()},this.closeMenu=function(){this.open=!1,this.$menu.detach()},this.resize=function(e){this.scrollbarWidth=this.scrollbarWidth||this.getScrollbarWidth();var t=Math.ceil($(".icon").outerWidth(!0)*this.columns+this.scrollbarWidth)+"px",i=this.height-2*parseInt(this.$menu.css("padding-top"));i-=this.filter!==!1?this.$filter.outerHeight(!0):0,i-=this.sizeSelector!==!1?this.$sizeSelector.outerHeight(!0):0,this.$container.css({width:t,height:i})},this.doFilter=function(e){""!==e?($(this).find("a.icon[data-filter*='"+e+"']").show(),$(this).find("a.icon:not([data-filter*='"+e+"'])").hide()):$(this).find("a.icon").show()},this.ucwords=function(e){return(e.replace(/-/g," ")+"").replace(/^([a-z\u00E0-\u00FC])|\s+([a-z\u00E0-\u00FC])/g,function(e){return e.toUpperCase()})},this.sortObj=function(e){var t,i,n=[],s={};for(t in e)n.push(t);for(n.sort(function(e,t){return e.toLowerCase().localeCompare(t.toLowerCase())}),i=0;i<n.length;i++)s[n[i]]=e[n[i]];return s},this.getScrollbarWidth=function(){var e=$('<div style="width: 100%; height:200px;">test</div>'),t=$('<div style="width:200px;height:150px; position: absolute; top: 0; left: 0; visibility: hidden; overflow:hidden;"></div>').append(e),i=e[0],n=t[0];$("body").append(n);var s=i.offsetWidth;t.css("overflow","scroll");var r=n.clientWidth;return t.remove(),s-r},self.createMenu(),this}}(jQuery),function(e,t){var i,n={},s=function(e,t){var i,n,s;if("string"==typeof e)return o(e);for(i=[],n=e.length,s=0;s<n;s++)i.push(o(e[s]));return t.apply(null,i)},r=function(e,t,i){2===arguments.length&&(i=t,t=null),s(t||[],function(){a(e,i,arguments)})},a=function(e,t,i){var r,a={exports:t};"function"==typeof t&&(i.length||(i=[s,a.exports,a]),r=t.apply(null,i),void 0!==r&&(a.exports=r)),n[e]=a.exports},o=function(t){var i=n[t]||e[t];if(!i)throw new Error("`"+t+"` is undefined");return i},h=function(e){var t,i,s,r,a,o;o=function(e){return e&&e.charAt(0).toUpperCase()+e.substr(1)};for(t in n)if(i=e,n.hasOwnProperty(t)){for(s=t.split("/"),a=o(s.pop());r=o(s.shift());)i[r]=i[r]||{},i=i[r];i[a]=n[t]}return e},l=function(i){return e.__dollar=i,h(t(e,r,s))};"object"==typeof module&&"object"==typeof module.exports?module.exports=l():"function"==typeof define&&define.amd?define(["jquery"],l):(i=e.WebUploader,e.WebUploader=l(),e.WebUploader.noConflict=function(){e.WebUploader=i})}(window,function(e,t,i){return t("dollar-third",[],function(){var t=e.__dollar||e.jQuery||e.Zepto;if(!t)throw new Error("jQuery or Zepto not found!");return t}),t("dollar",["dollar-third"],function(e){return e}),t("promise-third",["dollar"],function(e){return{Deferred:e.Deferred,when:e.when,isPromise:function(e){return e&&"function"==typeof e.then}}}),t("promise",["promise-third"],function(e){return e}),t("base",["dollar","promise"],function(t,i){function n(e){return function(){return o.apply(e,arguments)}}function s(e,t){return function(){return e.apply(t,arguments)}}function r(e){var t;return Object.create?Object.create(e):(t=function(){},t.prototype=e,new t)}var a=function(){},o=Function.call;return{version:"0.1.5",$:t,Deferred:i.Deferred,isPromise:i.isPromise,when:i.when,browser:function(e){var t={},i=e.match(/WebKit\/([\d.]+)/),n=e.match(/Chrome\/([\d.]+)/)||e.match(/CriOS\/([\d.]+)/),s=e.match(/MSIE\s([\d\.]+)/)||e.match(/(?:trident)(?:.*rv:([\w.]+))?/i),r=e.match(/Firefox\/([\d.]+)/),a=e.match(/Safari\/([\d.]+)/),o=e.match(/OPR\/([\d.]+)/);return i&&(t.webkit=parseFloat(i[1])),n&&(t.chrome=parseFloat(n[1])),s&&(t.ie=parseFloat(s[1])),r&&(t.firefox=parseFloat(r[1])),a&&(t.safari=parseFloat(a[1])),o&&(t.opera=parseFloat(o[1])),t}(navigator.userAgent),os:function(e){var t={},i=e.match(/(?:Android);?[\s\/]+([\d.]+)?/),n=e.match(/(?:iPad|iPod|iPhone).*OS\s([\d_]+)/);return i&&(t.android=parseFloat(i[1])),n&&(t.ios=parseFloat(n[1].replace(/_/g,"."))),t}(navigator.userAgent),inherits:function(e,i,n){var s;return"function"==typeof i?(s=i,i=null):s=i&&i.hasOwnProperty("constructor")?i.constructor:function(){return e.apply(this,arguments)},t.extend(!0,s,e,n||{}),s.__super__=e.prototype,s.prototype=r(e.prototype),i&&t.extend(!0,s.prototype,i),s},noop:a,bindFn:s,log:function(){return e.console?s(console.log,console):a}(),nextTick:function(){return function(e){setTimeout(e,1)}}(),slice:n([].slice),guid:function(){var e=0;return function(t){for(var i=(+new Date).toString(32),n=0;n<5;n++)i+=Math.floor(65535*Math.random()).toString(32);return(t||"wu_")+i+(e++).toString(32)}}(),formatSize:function(e,t,i){var n;for(i=i||["B","K","M","G","TB"];(n=i.shift())&&e>1024;)e/=1024;return("B"===n?e:e.toFixed(t||2))+n}}}),t("mediator",["base"],function(e){function t(e,t,i,n){return r.grep(e,function(e){return e&&(!t||e.e===t)&&(!i||e.cb===i||e.cb._cb===i)&&(!n||e.ctx===n)})}function i(e,t,i){r.each((e||"").split(o),function(e,n){i(n,t)})}function n(e,t){for(var i,n=!1,s=-1,r=e.length;++s<r;)if(i=e[s],i.cb.apply(i.ctx2,t)===!1){n=!0;break}return!n}var s,r=e.$,a=[].slice,o=/\s+/;return s={on:function(e,t,n){var s,r=this;return t?(s=this._events||(this._events=[]),i(e,t,function(e,t){var i={e:e};i.cb=t,i.ctx=n,i.ctx2=n||r,i.id=s.length,s.push(i)}),this):this},once:function(e,t,n){var s=this;return t?(i(e,t,function(e,t){var i=function(){return s.off(e,i),t.apply(n||s,arguments)};i._cb=t,s.on(e,i,n)}),s):s},off:function(e,n,s){var a=this._events;return a?e||n||s?(i(e,n,function(e,i){r.each(t(a,e,i,s),function(){delete a[this.id]})}),this):(this._events=[],this):this},trigger:function(e){var i,s,r;return this._events&&e?(i=a.call(arguments,1),s=t(this._events,e),r=t(this._events,"all"),n(s,i)&&n(r,arguments)):this}},r.extend({installTo:function(e){return r.extend(e,s)}},s)}),t("uploader",["base","mediator"],function(e,t){function i(e){this.options=n.extend(!0,{},i.options,e),this._init(this.options)}var n=e.$;return i.options={},t.installTo(i.prototype),n.each({upload:"start-upload",stop:"stop-upload",getFile:"get-file",getFiles:"get-files",addFile:"add-file",addFiles:"add-file",sort:"sort-files",removeFile:"remove-file",cancelFile:"cancel-file",skipFile:"skip-file",retry:"retry",isInProgress:"is-in-progress",makeThumb:"make-thumb",md5File:"md5-file",getDimension:"get-dimension",addButton:"add-btn",predictRuntimeType:"predict-runtime-type",refresh:"refresh",disable:"disable",enable:"enable",reset:"reset"},function(e,t){i.prototype[e]=function(){return this.request(t,arguments)}}),n.extend(i.prototype,{state:"pending",_init:function(e){var t=this;t.request("init",e,function(){t.state="ready",t.trigger("ready")})},option:function(e,t){var i=this.options;return arguments.length>1?void(n.isPlainObject(t)&&n.isPlainObject(i[e])?n.extend(i[e],t):i[e]=t):e?i[e]:i},getStats:function(){var e=this.request("get-stats");return e?{successNum:e.numOfSuccess,progressNum:e.numOfProgress,cancelNum:e.numOfCancel,invalidNum:e.numOfInvalid,uploadFailNum:e.numOfUploadFailed,queueNum:e.numOfQueue,interruptNum:e.numofInterrupt}:{}},trigger:function(e){var i=[].slice.call(arguments,1),s=this.options,r="on"+e.substring(0,1).toUpperCase()+e.substring(1);return!(t.trigger.apply(this,arguments)===!1||n.isFunction(s[r])&&s[r].apply(this,i)===!1||n.isFunction(this[r])&&this[r].apply(this,i)===!1||t.trigger.apply(t,[this,e].concat(i))===!1)},destroy:function(){this.request("destroy",arguments),this.off()},request:e.noop}),e.create=i.create=function(e){return new i(e)},e.Uploader=i,i}),t("runtime/runtime",["base","mediator"],function(e,t){function i(t){this.options=n.extend({container:document.body},t),this.uid=e.guid("rt_")}var n=e.$,s={},r=function(e){for(var t in e)if(e.hasOwnProperty(t))return t;return null};return n.extend(i.prototype,{getContainer:function(){var e,t,i=this.options;return this._container?this._container:(e=n(i.container||document.body),t=n(document.createElement("div")),t.attr("id","rt_"+this.uid),t.css({position:"absolute",top:"0px",left:"0px",width:"1px",height:"1px",overflow:"hidden"}),e.append(t),e.addClass("webuploader-container"),this._container=t,this._parent=e,t)},init:e.noop,exec:e.noop,destroy:function(){this._container&&this._container.remove(),this._parent&&this._parent.removeClass("webuploader-container"),this.off()}}),i.orders="html5,flash",i.addRuntime=function(e,t){s[e]=t},i.hasRuntime=function(e){return!!(e?s[e]:r(s))},i.create=function(e,t){var a,o;if(t=t||i.orders,n.each(t.split(/\s*,\s*/g),function(){if(s[this])return a=this,!1}),a=a||r(s),!a)throw new Error("Runtime Error");return o=new s[a](e)},t.installTo(i.prototype),i}),t("runtime/client",["base","mediator","runtime/runtime"],function(e,t,i){function n(t,n){var r,a=e.Deferred();this.uid=e.guid("client_"),this.runtimeReady=function(e){return a.done(e)},this.connectRuntime=function(t,o){if(r)throw new Error("already connected!");return a.done(o),"string"==typeof t&&s.get(t)&&(r=s.get(t)),r=r||s.get(null,n),r?(e.$.extend(r.options,t),r.__promise.then(a.resolve),r.__client++):(r=i.create(t,t.runtimeOrder),r.__promise=a.promise(),r.once("ready",a.resolve),r.init(),s.add(r),r.__client=1),n&&(r.__standalone=n),r},this.getRuntime=function(){return r},this.disconnectRuntime=function(){r&&(r.__client--,r.__client<=0&&(s.remove(r),delete r.__promise,r.destroy()),r=null)},this.exec=function(){if(r){var i=e.slice(arguments);return t&&i.unshift(t),r.exec.apply(this,i)}},this.getRuid=function(){return r&&r.uid},this.destroy=function(e){return function(){e&&e.apply(this,arguments),this.trigger("destroy"),this.off(),this.exec("destroy"),this.disconnectRuntime()}}(this.destroy)}var s;return s=function(){var e={};return{add:function(t){e[t.uid]=t},get:function(t,i){var n;if(t)return e[t];for(n in e)if(!i||!e[n].__standalone)return e[n];return null},remove:function(t){delete e[t.uid]}}}(),t.installTo(n.prototype),n}),t("lib/dnd",["base","mediator","runtime/client"],function(e,t,i){function n(e){e=this.options=s.extend({},n.options,e),e.container=s(e.container),e.container.length&&i.call(this,"DragAndDrop")}var s=e.$;return n.options={accept:null,disableGlobalDnd:!1},e.inherits(i,{constructor:n,init:function(){var e=this;e.connectRuntime(e.options,function(){e.exec("init"),e.trigger("ready")})}}),t.installTo(n.prototype),n}),t("widgets/widget",["base","uploader"],function(e,t){function i(e){if(!e)return!1;var t=e.length,i=s.type(e);return!(1!==e.nodeType||!t)||("array"===i||"function"!==i&&"string"!==i&&(0===t||"number"==typeof t&&t>0&&t-1 in e))}function n(e){this.owner=e,this.options=e.options}var s=e.$,r=t.prototype._init,a=t.prototype.destroy,o={},h=[];return s.extend(n.prototype,{init:e.noop,invoke:function(e,t){var i=this.responseMap;return i&&e in i&&i[e]in this&&s.isFunction(this[i[e]])?this[i[e]].apply(this,t):o},request:function(){return this.owner.request.apply(this.owner,arguments)}}),s.extend(t.prototype,{_init:function(){var e=this,t=e._widgets=[],i=e.options.disableWidgets||"";return s.each(h,function(n,s){(!i||!~i.indexOf(s._name))&&t.push(new s(e))}),r.apply(e,arguments)},request:function(t,n,s){var r,a,h,l,d=0,u=this._widgets,c=u&&u.length,p=[],f=[];for(n=i(n)?n:[n];d<c;d++)r=u[d],a=r.invoke(t,n),a!==o&&(e.isPromise(a)?f.push(a):p.push(a));return s||f.length?(h=e.when.apply(e,f),l=h.pipe?"pipe":"then",h[l](function(){var t=e.Deferred(),i=arguments;return 1===i.length&&(i=i[0]),setTimeout(function(){t.resolve(i)},1),t.promise()})[s?l:"done"](s||e.noop)):p[0]},destroy:function(){a.apply(this,arguments),this._widgets=null}}),t.register=n.register=function(t,i){var r,a={init:"init",destroy:"destroy",name:"anonymous"};return 1===arguments.length?(i=t,s.each(i,function(e){return"_"===e[0]||"name"===e?void("name"===e&&(a.name=i.name)):void(a[e.replace(/[A-Z]/g,"-$&").toLowerCase()]=e)})):a=s.extend(a,t),i.responseMap=a,r=e.inherits(n,i),r._name=a.name,h.push(r),r},t.unRegister=n.unRegister=function(e){if(e&&"anonymous"!==e)for(var t=h.length;t--;)h[t]._name===e&&h.splice(t,1)},n}),t("widgets/filednd",["base","uploader","lib/dnd","widgets/widget"],function(e,t,i){var n=e.$;return t.options.dnd="",t.register({name:"dnd",init:function(t){if(t.dnd&&"html5"===this.request("predict-runtime-type")){var s,r=this,a=e.Deferred(),o=n.extend({},{disableGlobalDnd:t.disableGlobalDnd,container:t.dnd,accept:t.accept});return this.dnd=s=new i(o),s.once("ready",a.resolve),s.on("drop",function(e){r.request("add-file",[e])}),s.on("accept",function(e){return r.owner.trigger("dndAccept",e)}),s.init(),a.promise()}},destroy:function(){this.dnd&&this.dnd.destroy()}})}),t("lib/filepaste",["base","mediator","runtime/client"],function(e,t,i){function n(e){e=this.options=s.extend({},e),e.container=s(e.container||document.body),i.call(this,"FilePaste")}var s=e.$;return e.inherits(i,{constructor:n,init:function(){var e=this;e.connectRuntime(e.options,function(){e.exec("init"),e.trigger("ready")})}}),t.installTo(n.prototype),n}),t("widgets/filepaste",["base","uploader","lib/filepaste","widgets/widget"],function(e,t,i){var n=e.$;return t.register({name:"paste",init:function(t){if(t.paste&&"html5"===this.request("predict-runtime-type")){var s,r=this,a=e.Deferred(),o=n.extend({},{container:t.paste,accept:t.accept});return this.paste=s=new i(o),s.once("ready",a.resolve),s.on("paste",function(e){r.owner.request("add-file",[e])}),s.init(),a.promise()}},destroy:function(){this.paste&&this.paste.destroy()}})}),t("lib/blob",["base","runtime/client"],function(e,t){function i(e,i){var n=this;n.source=i,n.ruid=e,this.size=i.size||0,!i.type&&this.ext&&~"jpg,jpeg,png,gif,bmp".indexOf(this.ext)?this.type="image/"+("jpg"===this.ext?"jpeg":this.ext):this.type=i.type||"application/octet-stream",t.call(n,"Blob"),this.uid=i.uid||this.uid,e&&n.connectRuntime(e)}return e.inherits(t,{constructor:i,slice:function(e,t){return this.exec("slice",e,t)},getSource:function(){return this.source}}),i}),t("lib/file",["base","lib/blob"],function(e,t){function i(e,i){var r;this.name=i.name||"untitled"+n++,r=s.exec(i.name)?RegExp.$1.toLowerCase():"",!r&&i.type&&(r=/\/(jpg|jpeg|png|gif|bmp)$/i.exec(i.type)?RegExp.$1.toLowerCase():"",this.name+="."+r),this.ext=r,this.lastModifiedDate=i.lastModifiedDate||(new Date).toLocaleString(),t.apply(this,arguments)}var n=1,s=/\.([^.]+)$/;return e.inherits(t,i)}),t("lib/filepicker",["base","runtime/client","lib/file"],function(t,i,n){function s(e){if(e=this.options=r.extend({},s.options,e),e.container=r(e.id),!e.container.length)throw new Error("按钮指定错误");e.innerHTML=e.innerHTML||e.label||e.container.html()||"",e.button=r(e.button||document.createElement("div")),e.button.html(e.innerHTML),e.container.html(e.button),i.call(this,"FilePicker",!0)}var r=t.$;return s.options={button:null,container:null,label:null,innerHTML:null,multiple:!0,accept:null,name:"file"},t.inherits(i,{constructor:s,init:function(){var i=this,s=i.options,a=s.button;a.addClass("webuploader-pick"),i.on("all",function(e){var t;switch(e){case"mouseenter":a.addClass("webuploader-pick-hover");break;case"mouseleave":a.removeClass("webuploader-pick-hover");break;case"change":t=i.exec("getFiles"),i.trigger("select",r.map(t,function(e){return e=new n(i.getRuid(),e),e._refer=s.container,
e}),s.container)}}),i.connectRuntime(s,function(){i.refresh(),i.exec("init",s),i.trigger("ready")}),this._resizeHandler=t.bindFn(this.refresh,this),r(e).on("resize",this._resizeHandler)},refresh:function(){var e=this.getRuntime().getContainer(),t=this.options.button,i=t.outerWidth?t.outerWidth():t.width(),n=t.outerHeight?t.outerHeight():t.height(),s=t.offset();i&&n&&e.css({bottom:"auto",right:"auto",width:i+"px",height:n+"px"}).offset(s)},enable:function(){var e=this.options.button;e.removeClass("webuploader-pick-disable"),this.refresh()},disable:function(){var e=this.options.button;this.getRuntime().getContainer().css({top:"-99999px"}),e.addClass("webuploader-pick-disable")},destroy:function(){var t=this.options.button;r(e).off("resize",this._resizeHandler),t.removeClass("webuploader-pick-disable webuploader-pick-hover webuploader-pick")}}),s}),t("widgets/filepicker",["base","uploader","lib/filepicker","widgets/widget"],function(e,t,i){var n=e.$;return n.extend(t.options,{pick:null,accept:null}),t.register({name:"picker",init:function(e){return this.pickers=[],e.pick&&this.addBtn(e.pick)},refresh:function(){n.each(this.pickers,function(){this.refresh()})},addBtn:function(t){var s=this,r=s.options,a=r.accept,o=[];if(t)return n.isPlainObject(t)||(t={id:t}),n(t.id).each(function(){var h,l,d;d=e.Deferred(),h=n.extend({},t,{accept:n.isPlainObject(a)?[a]:a,swf:r.swf,runtimeOrder:r.runtimeOrder,id:this}),l=new i(h),l.once("ready",d.resolve),l.on("select",function(e){s.owner.request("add-file",[e])}),l.init(),s.pickers.push(l),o.push(d.promise())}),e.when.apply(e,o)},disable:function(){n.each(this.pickers,function(){this.disable()})},enable:function(){n.each(this.pickers,function(){this.enable()})},destroy:function(){n.each(this.pickers,function(){this.destroy()}),this.pickers=null}})}),t("file",["base","mediator"],function(e,t){function i(){return r+a++}function n(e){this.name=e.name||"Untitled",this.size=e.size||0,this.type=e.type||"application/octet-stream",this.lastModifiedDate=e.lastModifiedDate||1*new Date,this.id=i(),this.ext=o.exec(this.name)?RegExp.$1:"",this.statusText="",h[this.id]=n.Status.INITED,this.source=e,this.loaded=0,this.on("error",function(e){this.setStatus(n.Status.ERROR,e)})}var s=e.$,r="WU_FILE_",a=0,o=/\.([^.]+)$/,h={};return s.extend(n.prototype,{setStatus:function(e,t){var i=h[this.id];"undefined"!=typeof t&&(this.statusText=t),e!==i&&(h[this.id]=e,this.trigger("statuschange",e,i))},getStatus:function(){return h[this.id]},getSource:function(){return this.source},destroy:function(){this.off(),delete h[this.id]}}),t.installTo(n.prototype),n.Status={INITED:"inited",QUEUED:"queued",PROGRESS:"progress",ERROR:"error",COMPLETE:"complete",CANCELLED:"cancelled",INTERRUPT:"interrupt",INVALID:"invalid"},n}),t("queue",["base","mediator","file"],function(e,t,i){function n(){this.stats={numOfQueue:0,numOfSuccess:0,numOfCancel:0,numOfProgress:0,numOfUploadFailed:0,numOfInvalid:0,numofDeleted:0,numofInterrupt:0},this._queue=[],this._map={}}var s=e.$,r=i.Status;return s.extend(n.prototype,{append:function(e){return this._queue.push(e),this._fileAdded(e),this},prepend:function(e){return this._queue.unshift(e),this._fileAdded(e),this},getFile:function(e){return"string"!=typeof e?e:this._map[e]},fetch:function(e){var t,i,n=this._queue.length;for(e=e||r.QUEUED,t=0;t<n;t++)if(i=this._queue[t],e===i.getStatus())return i;return null},sort:function(e){"function"==typeof e&&this._queue.sort(e)},getFiles:function(){for(var e,t=[].slice.call(arguments,0),i=[],n=0,r=this._queue.length;n<r;n++)e=this._queue[n],t.length&&!~s.inArray(e.getStatus(),t)||i.push(e);return i},removeFile:function(e){var t=this._map[e.id];t&&(delete this._map[e.id],e.destroy(),this.stats.numofDeleted++)},_fileAdded:function(e){var t=this,i=this._map[e.id];i||(this._map[e.id]=e,e.on("statuschange",function(e,i){t._onFileStatusChange(e,i)}))},_onFileStatusChange:function(e,t){var i=this.stats;switch(t){case r.PROGRESS:i.numOfProgress--;break;case r.QUEUED:i.numOfQueue--;break;case r.ERROR:i.numOfUploadFailed--;break;case r.INVALID:i.numOfInvalid--;break;case r.INTERRUPT:i.numofInterrupt--}switch(e){case r.QUEUED:i.numOfQueue++;break;case r.PROGRESS:i.numOfProgress++;break;case r.ERROR:i.numOfUploadFailed++;break;case r.COMPLETE:i.numOfSuccess++;break;case r.CANCELLED:i.numOfCancel++;break;case r.INVALID:i.numOfInvalid++;break;case r.INTERRUPT:i.numofInterrupt++}}}),t.installTo(n.prototype),n}),t("widgets/queue",["base","uploader","queue","file","lib/file","runtime/client","widgets/widget"],function(e,t,i,n,s,r){var a=e.$,o=/\.\w+$/,h=n.Status;return t.register({name:"queue",init:function(t){var n,s,o,h,l,d,u,c=this;if(a.isPlainObject(t.accept)&&(t.accept=[t.accept]),t.accept){for(l=[],o=0,s=t.accept.length;o<s;o++)h=t.accept[o].extensions,h&&l.push(h);l.length&&(d="\\."+l.join(",").replace(/,/g,"$|\\.").replace(/\*/g,".*")+"$"),c.accept=new RegExp(d,"i")}if(c.queue=new i,c.stats=c.queue.stats,"html5"===this.request("predict-runtime-type"))return n=e.Deferred(),this.placeholder=u=new r("Placeholder"),u.connectRuntime({runtimeOrder:"html5"},function(){c._ruid=u.getRuid(),n.resolve()}),n.promise()},_wrapFile:function(e){if(!(e instanceof n)){if(!(e instanceof s)){if(!this._ruid)throw new Error("Can't add external files.");e=new s(this._ruid,e)}e=new n(e)}return e},acceptFile:function(e){var t=!e||!e.size||this.accept&&o.exec(e.name)&&!this.accept.test(e.name);return!t},_addFile:function(e){var t=this;if(e=t._wrapFile(e),t.owner.trigger("beforeFileQueued",e))return t.acceptFile(e)?(t.queue.append(e),t.owner.trigger("fileQueued",e),e):void t.owner.trigger("error","Q_TYPE_DENIED",e)},getFile:function(e){return this.queue.getFile(e)},addFile:function(e){var t=this;e.length||(e=[e]),e=a.map(e,function(e){return t._addFile(e)}),t.owner.trigger("filesQueued",e),t.options.auto&&setTimeout(function(){t.request("start-upload")},20)},getStats:function(){return this.stats},removeFile:function(e,t){var i=this;e=e.id?e:i.queue.getFile(e),this.request("cancel-file",e),t&&this.queue.removeFile(e)},getFiles:function(){return this.queue.getFiles.apply(this.queue,arguments)},fetchFile:function(){return this.queue.fetch.apply(this.queue,arguments)},retry:function(e,t){var i,n,s,r=this;if(e)return e=e.id?e:r.queue.getFile(e),e.setStatus(h.QUEUED),void(t||r.request("start-upload"));for(i=r.queue.getFiles(h.ERROR),n=0,s=i.length;n<s;n++)e=i[n],e.setStatus(h.QUEUED);r.request("start-upload")},sortFiles:function(){return this.queue.sort.apply(this.queue,arguments)},reset:function(){this.owner.trigger("reset"),this.queue=new i,this.stats=this.queue.stats},destroy:function(){this.reset(),this.placeholder&&this.placeholder.destroy()}})}),t("widgets/runtime",["uploader","runtime/runtime","widgets/widget"],function(e,t){return e.support=function(){return t.hasRuntime.apply(t,arguments)},e.register({name:"runtime",init:function(){if(!this.predictRuntimeType())throw Error("Runtime Error")},predictRuntimeType:function(){var e,i,n=this.options.runtimeOrder||t.orders,s=this.type;if(!s)for(n=n.split(/\s*,\s*/g),e=0,i=n.length;e<i;e++)if(t.hasRuntime(n[e])){this.type=s=n[e];break}return s}})}),t("lib/transport",["base","runtime/client","mediator"],function(e,t,i){function n(e){var i=this;e=i.options=s.extend(!0,{},n.options,e||{}),t.call(this,"Transport"),this._blob=null,this._formData=e.formData||{},this._headers=e.headers||{},this.on("progress",this._timeout),this.on("load error",function(){i.trigger("progress",1),clearTimeout(i._timer)})}var s=e.$;return n.options={server:"",method:"POST",withCredentials:!1,fileVal:"file",timeout:12e4,formData:{},headers:{},sendAsBinary:!1},s.extend(n.prototype,{appendBlob:function(e,t,i){var n=this,s=n.options;n.getRuid()&&n.disconnectRuntime(),n.connectRuntime(t.ruid,function(){n.exec("init")}),n._blob=t,s.fileVal=e||s.fileVal,s.filename=i||s.filename},append:function(e,t){"object"==typeof e?s.extend(this._formData,e):this._formData[e]=t},setRequestHeader:function(e,t){"object"==typeof e?s.extend(this._headers,e):this._headers[e]=t},send:function(e){this.exec("send",e),this._timeout()},abort:function(){return clearTimeout(this._timer),this.exec("abort")},destroy:function(){this.trigger("destroy"),this.off(),this.exec("destroy"),this.disconnectRuntime()},getResponse:function(){return this.exec("getResponse")},getResponseAsJson:function(){return this.exec("getResponseAsJson")},getStatus:function(){return this.exec("getStatus")},_timeout:function(){var e=this,t=e.options.timeout;t&&(clearTimeout(e._timer),e._timer=setTimeout(function(){e.abort(),e.trigger("error","timeout")},t))}}),i.installTo(n.prototype),n}),t("widgets/upload",["base","uploader","file","lib/transport","widgets/widget"],function(e,t,i,n){function s(e,t){var i,n,s=[],r=e.source,a=r.size,o=t?Math.ceil(a/t):1,h=0,l=0;for(n={file:e,has:function(){return!!s.length},shift:function(){return s.shift()},unshift:function(e){s.unshift(e)}};l<o;)i=Math.min(t,a-h),s.push({file:e,start:h,end:t?h+i:a,total:a,chunks:o,chunk:l++,cuted:n}),h+=i;return e.blocks=s.concat(),e.remaning=s.length,n}var r=e.$,a=e.isPromise,o=i.Status;r.extend(t.options,{prepareNextFile:!1,chunked:!1,chunkSize:5242880,chunkRetry:2,threads:3,formData:{}}),t.register({name:"upload",init:function(){var t=this.owner,i=this;this.runing=!1,this.progress=!1,t.on("startUpload",function(){i.progress=!0}).on("uploadFinished",function(){i.progress=!1}),this.pool=[],this.stack=[],this.pending=[],this.remaning=0,this.__tick=e.bindFn(this._tick,this),t.on("uploadComplete",function(e){e.blocks&&r.each(e.blocks,function(e,t){t.transport&&(t.transport.abort(),t.transport.destroy()),delete t.transport}),delete e.blocks,delete e.remaning})},reset:function(){this.request("stop-upload",!0),this.runing=!1,this.pool=[],this.stack=[],this.pending=[],this.remaning=0,this._trigged=!1,this._promise=null},startUpload:function(t){var i=this;if(r.each(i.request("get-files",o.INVALID),function(){i.request("remove-file",this)}),t)if(t=t.id?t:i.request("get-file",t),t.getStatus()===o.INTERRUPT)r.each(i.pool,function(e,i){i.file===t&&i.transport&&i.transport.send()}),t.setStatus(o.QUEUED);else{if(t.getStatus()===o.PROGRESS)return;t.setStatus(o.QUEUED)}else r.each(i.request("get-files",[o.INITED]),function(){this.setStatus(o.QUEUED)});i.runing||(i.runing=!0,r.each(i.pool,function(e,t){var n=t.file;n.getStatus()===o.INTERRUPT&&(n.setStatus(o.PROGRESS),i._trigged=!1,t.transport&&t.transport.send())}),t||r.each(i.request("get-files",o.INTERRUPT),function(){this.setStatus(o.PROGRESS)}),i._trigged=!1,e.nextTick(i.__tick),i.owner.trigger("startUpload"))},stopUpload:function(t,i){var n=this;if(t===!0&&(i=t,t=null),n.runing!==!1){if(t){if(t=t.id?t:n.request("get-file",t),t.getStatus()!==o.PROGRESS&&t.getStatus()!==o.QUEUED)return;return t.setStatus(o.INTERRUPT),r.each(n.pool,function(e,i){i.file===t&&(i.transport&&i.transport.abort(),n._putback(i),n._popBlock(i))}),e.nextTick(n.__tick)}n.runing=!1,this._promise&&this._promise.file&&this._promise.file.setStatus(o.INTERRUPT),i&&r.each(n.pool,function(e,t){t.transport&&t.transport.abort(),t.file.setStatus(o.INTERRUPT)}),n.owner.trigger("stopUpload")}},cancelFile:function(e){e=e.id?e:this.request("get-file",e),e.blocks&&r.each(e.blocks,function(e,t){var i=t.transport;i&&(i.abort(),i.destroy(),delete t.transport)}),e.setStatus(o.CANCELLED),this.owner.trigger("fileDequeued",e)},isInProgress:function(){return!!this.progress},_getStats:function(){return this.request("get-stats")},skipFile:function(e,t){e=e.id?e:this.request("get-file",e),e.setStatus(t||o.COMPLETE),e.skipped=!0,e.blocks&&r.each(e.blocks,function(e,t){var i=t.transport;i&&(i.abort(),i.destroy(),delete t.transport)}),this.owner.trigger("uploadSkip",e)},_tick:function(){var t,i,n=this,s=n.options;return n._promise?n._promise.always(n.__tick):void(n.pool.length<s.threads&&(i=n._nextBlock())?(n._trigged=!1,t=function(t){n._promise=null,t&&t.file&&n._startSend(t),e.nextTick(n.__tick)},n._promise=a(i)?i.always(t):t(i)):n.remaning||n._getStats().numOfQueue||n._getStats().numofInterrupt||(n.runing=!1,n._trigged||e.nextTick(function(){n.owner.trigger("uploadFinished")}),n._trigged=!0))},_putback:function(e){var t;e.cuted.unshift(e),t=this.stack.indexOf(e.cuted),~t||this.stack.unshift(e.cuted)},_getStack:function(){for(var e,t=0;e=this.stack[t++];){if(e.has()&&e.file.getStatus()===o.PROGRESS)return e;(!e.has()||e.file.getStatus()!==o.PROGRESS&&e.file.getStatus()!==o.INTERRUPT)&&this.stack.splice(--t,1)}return null},_nextBlock:function(){var e,t,i,n,r=this,o=r.options;return(e=this._getStack())?(o.prepareNextFile&&!r.pending.length&&r._prepareNextFile(),e.shift()):r.runing?(!r.pending.length&&r._getStats().numOfQueue&&r._prepareNextFile(),t=r.pending.shift(),i=function(t){return t?(e=s(t,o.chunked?o.chunkSize:0),r.stack.push(e),e.shift()):null},a(t)?(n=t.file,t=t[t.pipe?"pipe":"then"](i),t.file=n,t):i(t)):void 0},_prepareNextFile:function(){var e,t=this,i=t.request("fetch-file"),n=t.pending;i&&(e=t.request("before-send-file",i,function(){return i.getStatus()===o.PROGRESS||i.getStatus()===o.INTERRUPT?i:t._finishFile(i)}),t.owner.trigger("uploadStart",i),i.setStatus(o.PROGRESS),e.file=i,e.done(function(){var t=r.inArray(e,n);~t&&n.splice(t,1,i)}),e.fail(function(e){i.setStatus(o.ERROR,e),t.owner.trigger("uploadError",i,e),t.owner.trigger("uploadComplete",i)}),n.push(e))},_popBlock:function(e){var t=r.inArray(e,this.pool);this.pool.splice(t,1),e.file.remaning--,this.remaning--},_startSend:function(t){var i,n=this,s=t.file;return s.getStatus()!==o.PROGRESS?void(s.getStatus()===o.INTERRUPT&&n._putback(t)):(n.pool.push(t),n.remaning++,t.blob=1===t.chunks?s.source:s.source.slice(t.start,t.end),i=n.request("before-send",t,function(){s.getStatus()===o.PROGRESS?n._doSend(t):(n._popBlock(t),e.nextTick(n.__tick))}),void i.fail(function(){1===s.remaning?n._finishFile(s).always(function(){t.percentage=1,n._popBlock(t),n.owner.trigger("uploadComplete",s),e.nextTick(n.__tick)}):(t.percentage=1,n._popBlock(t),e.nextTick(n.__tick))}))},_doSend:function(t){var i,s,a=this,h=a.owner,l=a.options,d=t.file,u=new n(l),c=r.extend({},l.formData),p=r.extend({},l.headers);t.transport=u,u.on("destroy",function(){delete t.transport,a._popBlock(t),e.nextTick(a.__tick)}),u.on("progress",function(e){var i=0,n=0;i=t.percentage=e,t.chunks>1&&(r.each(d.blocks,function(e,t){n+=(t.percentage||0)*(t.end-t.start)}),i=n/d.size),h.trigger("uploadProgress",d,i||0)}),i=function(e){var i;return s=u.getResponseAsJson()||{},s._raw=u.getResponse(),i=function(t){e=t},h.trigger("uploadAccept",t,s,i)||(e=e||"server"),e},u.on("error",function(e,n){t.retried=t.retried||0,t.chunks>1&&~"http,abort".indexOf(e)&&t.retried<l.chunkRetry?(t.retried++,u.send()):(n||"server"!==e||(e=i(e)),d.setStatus(o.ERROR,e),h.trigger("uploadError",d,e),h.trigger("uploadComplete",d))}),u.on("load",function(){var e;return(e=i())?void u.trigger("error",e,!0):void(1===d.remaning?a._finishFile(d,s):u.destroy())}),c=r.extend(c,{id:d.id,name:d.name,type:d.type,lastModifiedDate:d.lastModifiedDate,size:d.size}),t.chunks>1&&r.extend(c,{chunks:t.chunks,chunk:t.chunk}),h.trigger("uploadBeforeSend",t,c,p),u.appendBlob(l.fileVal,t.blob,d.name),u.append(c),u.setRequestHeader(p),u.send()},_finishFile:function(e,t,i){var n=this.owner;return n.request("after-send-file",arguments,function(){e.setStatus(o.COMPLETE),n.trigger("uploadSuccess",e,t,i)}).fail(function(t){e.getStatus()===o.PROGRESS&&e.setStatus(o.ERROR,t),n.trigger("uploadError",e,t)}).always(function(){n.trigger("uploadComplete",e)})}})}),t("widgets/validator",["base","uploader","file","widgets/widget"],function(e,t,i){var n,s=e.$,r={};return n={addValidator:function(e,t){r[e]=t},removeValidator:function(e){delete r[e]}},t.register({name:"validator",init:function(){var t=this;e.nextTick(function(){s.each(r,function(){this.call(t.owner)})})}}),n.addValidator("fileNumLimit",function(){var e=this,t=e.options,i=0,n=parseInt(t.fileNumLimit,10),s=!0;n&&(e.on("beforeFileQueued",function(e){return i>=n&&s&&(s=!1,this.trigger("error","Q_EXCEED_NUM_LIMIT",n,e),setTimeout(function(){s=!0},1)),!(i>=n)}),e.on("fileQueued",function(){i++}),e.on("fileDequeued",function(){i--}),e.on("reset",function(){i=0}))}),n.addValidator("fileSizeLimit",function(){var e=this,t=e.options,i=0,n=parseInt(t.fileSizeLimit,10),s=!0;n&&(e.on("beforeFileQueued",function(e){var t=i+e.size>n;return t&&s&&(s=!1,this.trigger("error","Q_EXCEED_SIZE_LIMIT",n,e),setTimeout(function(){s=!0},1)),!t}),e.on("fileQueued",function(e){i+=e.size}),e.on("fileDequeued",function(e){i-=e.size}),e.on("reset",function(){i=0}))}),n.addValidator("fileSingleSizeLimit",function(){var e=this,t=e.options,n=t.fileSingleSizeLimit;n&&e.on("beforeFileQueued",function(e){if(e.size>n)return e.setStatus(i.Status.INVALID,"exceed_size"),this.trigger("error","F_EXCEED_SIZE",n,e),!1})}),n.addValidator("duplicate",function(){function e(e){for(var t,i=0,n=0,s=e.length;n<s;n++)t=e.charCodeAt(n),i=t+(i<<6)+(i<<16)-i;return i}var t=this,i=t.options,n={};i.duplicate||(t.on("beforeFileQueued",function(t){var i=t.__hash||(t.__hash=e(t.name+t.size+t.lastModifiedDate));if(n[i])return this.trigger("error","F_DUPLICATE",t),!1}),t.on("fileQueued",function(e){var t=e.__hash;t&&(n[t]=!0)}),t.on("fileDequeued",function(e){var t=e.__hash;t&&delete n[t]}),t.on("reset",function(){n={}}))}),n}),t("runtime/compbase",[],function(){function e(e,t){this.owner=e,this.options=e.options,this.getRuntime=function(){return t},this.getRuid=function(){return t.uid},this.trigger=function(){return e.trigger.apply(e,arguments)}}return e}),t("runtime/html5/runtime",["base","runtime/runtime","runtime/compbase"],function(t,i,n){function s(){var e={},n=this,s=this.destroy;i.apply(n,arguments),n.type=r,n.exec=function(i,s){var r,o=this,h=o.uid,l=t.slice(arguments,2);if(a[i]&&(r=e[h]=e[h]||new a[i](o,n),r[s]))return r[s].apply(r,l)},n.destroy=function(){return s&&s.apply(this,arguments)}}var r="html5",a={};return t.inherits(i,{constructor:s,init:function(){var e=this;setTimeout(function(){e.trigger("ready")},1)}}),s.register=function(e,i){var s=a[e]=t.inherits(n,i);return s},e.Blob&&e.FileReader&&e.DataView&&i.addRuntime(r,s),s}),t("runtime/html5/blob",["runtime/html5/runtime","lib/blob"],function(e,t){return e.register("Blob",{slice:function(e,i){var n=this.owner.source,s=n.slice||n.webkitSlice||n.mozSlice;return n=s.call(n,e,i),new t(this.getRuid(),n)}})}),t("runtime/html5/dnd",["base","runtime/html5/runtime","lib/file"],function(e,t,i){var n=e.$,s="webuploader-dnd-";return t.register("DragAndDrop",{init:function(){var t=this.elem=this.options.container;this.dragEnterHandler=e.bindFn(this._dragEnterHandler,this),this.dragOverHandler=e.bindFn(this._dragOverHandler,this),this.dragLeaveHandler=e.bindFn(this._dragLeaveHandler,this),this.dropHandler=e.bindFn(this._dropHandler,this),this.dndOver=!1,t.on("dragenter",this.dragEnterHandler),t.on("dragover",this.dragOverHandler),t.on("dragleave",this.dragLeaveHandler),t.on("drop",this.dropHandler),this.options.disableGlobalDnd&&(n(document).on("dragover",this.dragOverHandler),n(document).on("drop",this.dropHandler))},_dragEnterHandler:function(e){var t,i=this,n=i._denied||!1;return e=e.originalEvent||e,i.dndOver||(i.dndOver=!0,t=e.dataTransfer.items,t&&t.length&&(i._denied=n=!i.trigger("accept",t)),i.elem.addClass(s+"over"),i.elem[n?"addClass":"removeClass"](s+"denied")),e.dataTransfer.dropEffect=n?"none":"copy",!1},_dragOverHandler:function(e){var t=this.elem.parent().get(0);return!(t&&!n.contains(t,e.currentTarget))&&(clearTimeout(this._leaveTimer),this._dragEnterHandler.call(this,e),!1)},_dragLeaveHandler:function(){var e,t=this;return e=function(){t.dndOver=!1,t.elem.removeClass(s+"over "+s+"denied")},clearTimeout(t._leaveTimer),t._leaveTimer=setTimeout(e,100),!1},_dropHandler:function(e){var t,r,a=this,o=a.getRuid(),h=a.elem.parent().get(0);if(h&&!n.contains(h,e.currentTarget))return!1;e=e.originalEvent||e,t=e.dataTransfer;try{r=t.getData("text/html")}catch(l){}return r?void 0:(a._getTansferFiles(t,function(e){a.trigger("drop",n.map(e,function(e){return new i(o,e)}))}),a.dndOver=!1,a.elem.removeClass(s+"over"),!1)},_getTansferFiles:function(t,i){var n,s,r,a,o,h,l,d=[],u=[];for(n=t.items,s=t.files,l=!(!n||!n[0].webkitGetAsEntry),o=0,h=s.length;o<h;o++)r=s[o],a=n&&n[o],l&&a.webkitGetAsEntry().isDirectory?u.push(this._traverseDirectoryTree(a.webkitGetAsEntry(),d)):d.push(r);e.when.apply(e,u).done(function(){d.length&&i(d)})},_traverseDirectoryTree:function(t,i){var n=e.Deferred(),s=this;return t.isFile?t.file(function(e){i.push(e),n.resolve()}):t.isDirectory&&t.createReader().readEntries(function(t){var r,a=t.length,o=[],h=[];for(r=0;r<a;r++)o.push(s._traverseDirectoryTree(t[r],h));e.when.apply(e,o).then(function(){i.push.apply(i,h),n.resolve()},n.reject)}),n.promise()},destroy:function(){var e=this.elem;e&&(e.off("dragenter",this.dragEnterHandler),e.off("dragover",this.dragOverHandler),e.off("dragleave",this.dragLeaveHandler),e.off("drop",this.dropHandler),this.options.disableGlobalDnd&&(n(document).off("dragover",this.dragOverHandler),n(document).off("drop",this.dropHandler)))}})}),t("runtime/html5/filepaste",["base","runtime/html5/runtime","lib/file"],function(e,t,i){return t.register("FilePaste",{init:function(){var t,i,n,s,r=this.options,a=this.elem=r.container,o=".*";if(r.accept){for(t=[],i=0,n=r.accept.length;i<n;i++)s=r.accept[i].mimeTypes,s&&t.push(s);t.length&&(o=t.join(","),o=o.replace(/,/g,"|").replace(/\*/g,".*"))}this.accept=o=new RegExp(o,"i"),this.hander=e.bindFn(this._pasteHander,this),a.on("paste",this.hander)},_pasteHander:function(e){var t,n,s,r,a,o=[],h=this.getRuid();for(e=e.originalEvent||e,t=e.clipboardData.items,r=0,a=t.length;r<a;r++)n=t[r],"file"===n.kind&&(s=n.getAsFile())&&o.push(new i(h,s));o.length&&(e.preventDefault(),e.stopPropagation(),this.trigger("paste",o))},destroy:function(){this.elem.off("paste",this.hander)}})}),t("runtime/html5/filepicker",["base","runtime/html5/runtime"],function(e,t){var i=e.$;return t.register("FilePicker",{init:function(){var e,t,n,s,r=this.getRuntime().getContainer(),a=this,o=a.owner,h=a.options,l=this.label=i(document.createElement("label")),d=this.input=i(document.createElement("input"));if(d.attr("type","file"),d.attr("name",h.name),d.addClass("webuploader-element-invisible"),l.on("click",function(){d.trigger("click")}),l.css({opacity:0,width:"100%",height:"100%",display:"block",cursor:"pointer",background:"#ffffff"}),h.multiple&&d.attr("multiple","multiple"),h.accept&&h.accept.length>0){for(e=[],t=0,n=h.accept.length;t<n;t++)e.push(h.accept[t].mimeTypes);d.attr("accept",e.join(","))}r.append(d),r.append(l),s=function(e){o.trigger(e.type)},d.on("change",function(e){var t,n=arguments.callee;a.files=e.target.files,t=this.cloneNode(!0),t.value=null,this.parentNode.replaceChild(t,this),d.off(),d=i(t).on("change",n).on("mouseenter mouseleave",s),o.trigger("change")}),l.on("mouseenter mouseleave",s)},getFiles:function(){return this.files},destroy:function(){this.input.off(),this.label.off()}})}),t("runtime/html5/transport",["base","runtime/html5/runtime"],function(e,t){var i=e.noop,n=e.$;return t.register("Transport",{init:function(){this._status=0,this._response=null},send:function(){var t,i,s,r=this.owner,a=this.options,o=this._initAjax(),h=r._blob,l=a.server;a.sendAsBinary?(l+=(/\?/.test(l)?"&":"?")+n.param(r._formData),i=h.getSource()):(t=new FormData,n.each(r._formData,function(e,i){t.append(e,i)}),t.append(a.fileVal,h.getSource(),a.filename||r._formData.name||"")),a.withCredentials&&"withCredentials"in o?(o.open(a.method,l,!0),o.withCredentials=!0):o.open(a.method,l),this._setRequestHeader(o,a.headers),i?(o.overrideMimeType&&o.overrideMimeType("application/octet-stream"),e.os.android?(s=new FileReader,s.onload=function(){o.send(this.result),s=s.onload=null},s.readAsArrayBuffer(i)):o.send(i)):o.send(t)},getResponse:function(){return this._response},getResponseAsJson:function(){return this._parseJson(this._response)},getStatus:function(){return this._status},abort:function(){var e=this._xhr;e&&(e.upload.onprogress=i,e.onreadystatechange=i,e.abort(),this._xhr=e=null)},destroy:function(){this.abort()},_initAjax:function(){var e=this,t=new XMLHttpRequest,n=this.options;return!n.withCredentials||"withCredentials"in t||"undefined"==typeof XDomainRequest||(t=new XDomainRequest),t.upload.onprogress=function(t){var i=0;return t.lengthComputable&&(i=t.loaded/t.total),e.trigger("progress",i)},t.onreadystatechange=function(){if(4===t.readyState)return t.upload.onprogress=i,t.onreadystatechange=i,e._xhr=null,e._status=t.status,t.status>=200&&t.status<300?(e._response=t.responseText,e.trigger("load")):t.status>=500&&t.status<600?(e._response=t.responseText,e.trigger("error","server")):e.trigger("error",e._status?"http":"abort")},e._xhr=t,t},_setRequestHeader:function(e,t){n.each(t,function(t,i){e.setRequestHeader(t,i)})},_parseJson:function(e){var t;try{t=JSON.parse(e)}catch(i){t={}}return t}})}),t("runtime/flash/runtime",["base","runtime/runtime","runtime/compbase"],function(t,i,n){function s(){var e;try{e=navigator.plugins["Shockwave Flash"],e=e.description}catch(t){try{e=new ActiveXObject("ShockwaveFlash.ShockwaveFlash").GetVariable("$version")}catch(i){e="0.0"}}return e=e.match(/\d+/g),parseFloat(e[0]+"."+e[1],10)}function r(){function n(e,t){var i,n,s=e.type||e;i=s.split("::"),n=i[0],s=i[1],"Ready"===s&&n===l.uid?l.trigger("ready"):r[n]&&r[n].trigger(s.toLowerCase(),e,t)}var s={},r={},a=this.destroy,l=this,d=t.guid("webuploader_");i.apply(l,arguments),l.type=o,l.exec=function(e,i){var n,a=this,o=a.uid,d=t.slice(arguments,2);return r[o]=a,h[e]&&(s[o]||(s[o]=new h[e](a,l)),n=s[o],n[i])?n[i].apply(n,d):l.flashExec.apply(a,arguments)},e[d]=function(){var e=arguments;setTimeout(function(){n.apply(null,e)},1)},this.jsreciver=d,this.destroy=function(){return a&&a.apply(this,arguments)},this.flashExec=function(e,i){var n=l.getFlash(),s=t.slice(arguments,2);return n.exec(this.uid,e,i,s)}}var a=t.$,o="flash",h={};return t.inherits(i,{constructor:r,init:function(){var e,i=this.getContainer(),n=this.options;i.css({position:"absolute",top:"-8px",left:"-8px",width:"9px",height:"9px",overflow:"hidden"}),e='<object id="'+this.uid+'" type="application/x-shockwave-flash" data="'+n.swf+'" ',t.browser.ie&&(e+='classid="clsid:d27cdb6e-ae6d-11cf-96b8-444553540000" '),e+='width="100%" height="100%" style="outline:0"><param name="movie" value="'+n.swf+'" /><param name="flashvars" value="uid='+this.uid+"&jsreciver="+this.jsreciver+'" /><param name="wmode" value="transparent" /><param name="allowscriptaccess" value="always" /></object>',i.html(e)},getFlash:function(){return this._flash?this._flash:(this._flash=a("#"+this.uid).get(0),this._flash)}}),r.register=function(e,i){return i=h[e]=t.inherits(n,a.extend({flashExec:function(){var e=this.owner,t=this.getRuntime();return t.flashExec.apply(e,arguments)}},i))},s()>=11.4&&i.addRuntime(o,r),r}),t("runtime/flash/filepicker",["base","runtime/flash/runtime"],function(e,t){var i=e.$;return t.register("FilePicker",{init:function(e){var t,n,s=i.extend({},e);for(t=s.accept&&s.accept.length,n=0;n<t;n++)s.accept[n].title||(s.accept[n].title="Files");delete s.button,delete s.id,delete s.container,this.flashExec("FilePicker","init",s)},destroy:function(){this.flashExec("FilePicker","destroy")}})}),t("runtime/flash/transport",["base","runtime/flash/runtime","runtime/client"],function(t,i,n){var s=t.$;return i.register("Transport",{init:function(){this._status=0,this._response=null,this._responseJson=null},send:function(){var e,t=this.owner,i=this.options,n=this._initAjax(),r=t._blob,a=i.server;n.connectRuntime(r.ruid),i.sendAsBinary?(a+=(/\?/.test(a)?"&":"?")+s.param(t._formData),e=r.uid):(s.each(t._formData,function(e,t){n.exec("append",e,t)}),n.exec("appendBlob",i.fileVal,r.uid,i.filename||t._formData.name||"")),this._setRequestHeader(n,i.headers),n.exec("send",{method:i.method,url:a,forceURLStream:i.forceURLStream,mimeType:"application/octet-stream"},e)},getStatus:function(){return this._status},getResponse:function(){return this._response||""},getResponseAsJson:function(){return this._responseJson},abort:function(){var e=this._xhr;e&&(e.exec("abort"),e.destroy(),this._xhr=e=null)},destroy:function(){this.abort()},_initAjax:function(){var t=this,i=new n("XMLHttpRequest");return i.on("uploadprogress progress",function(e){var i=e.loaded/e.total;return i=Math.min(1,Math.max(0,i)),t.trigger("progress",i)}),i.on("load",function(){var n,s=i.exec("getStatus"),r=!1,a="";return i.off(),t._xhr=null,s>=200&&s<300?r=!0:s>=500&&s<600?(r=!0,a="server"):a="http",r&&(t._response=i.exec("getResponse"),t._response=decodeURIComponent(t._response),n=e.JSON&&e.JSON.parse||function(e){try{return new Function("return "+e).call()}catch(t){return{}}},t._responseJson=t._response?n(t._response):{}),i.destroy(),i=null,a?t.trigger("error",a):t.trigger("load")}),i.on("error",function(){i.off(),t._xhr=null,t.trigger("error","http")}),t._xhr=i,i},_setRequestHeader:function(e,t){s.each(t,function(t,i){e.exec("setRequestHeader",t,i)})}})}),t("preset/withoutimage",["base","widgets/filednd","widgets/filepaste","widgets/filepicker","widgets/queue","widgets/runtime","widgets/upload","widgets/validator","runtime/html5/blob","runtime/html5/dnd","runtime/html5/filepaste","runtime/html5/filepicker","runtime/html5/transport","runtime/flash/filepicker","runtime/flash/transport"],function(e){return e}),t("webuploader",["preset/withoutimage"],function(e){return e}),i("webuploader")});
//# sourceMappingURL=lyui.extend.min.js.map
